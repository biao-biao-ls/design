# ğŸ—ï¸ KNZN é¡¹ç›®æ¶æ„ä¸éƒ¨ç½²æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**é¡¹ç›®åç§°**: KNZN ç¡¬ä»¶å­¦ä¹ ç½‘ç«™ - èµ›åšæœ‹å…‹é£æ ¼æ¸¸æˆåŒ–å¹³å°  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç¼–åˆ¶æ—¶é—´**: 2024-12-23  
**å®¡æ ¸çŠ¶æ€**: âœ… æœ€ç»ˆç¡®å®šç‰ˆæœ¬  
**æ–‡æ¡£ç±»å‹**: å®Œæ•´æ¶æ„ä¸éƒ¨ç½²è§„èŒƒ

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

KNZN æ˜¯ä¸€ä¸ªé¢å‘å…¨çƒå¼€å‘è€…çš„ç¡¬ä»¶å­¦ä¹ å¹³å°ï¼Œé‡‡ç”¨èµ›åšæœ‹å…‹é£æ ¼çš„æ¸¸æˆåŒ–è®¾è®¡ï¼Œé€šè¿‡ Wokwi ä»¿çœŸå™¨æä¾›é›¶æˆæœ¬çš„ç¡¬ä»¶å­¦ä¹ ä½“éªŒã€‚é¡¹ç›®å®šä½ä¸ºæµ·å¤–å¸‚åœºï¼Œé‡ç‚¹å…³æ³¨ GDPR/CCPA åˆè§„ã€é‚®ä»¶æœåŠ¡å’Œå…¨çƒ CDN éƒ¨ç½²ã€‚

### æ ¸å¿ƒç‰¹è‰²
- **é›¶æˆæœ¬å¼€å§‹**: æ— éœ€è´­ä¹°ç¡¬ä»¶ï¼ŒåŸºäº Wokwi äº‘ç«¯ä»¿çœŸ
- **æ¸¸æˆåŒ–å­¦ä¹ **: æŠ€èƒ½åœ°å›¾ã€å¾½ç« ç³»ç»Ÿã€XP å‡çº§æœºåˆ¶
- **æµ·å¤–å¸‚åœº**: Email ç™»å½•ã€LinkedIn é›†æˆã€å…¨çƒ CDN
- **è‡ªæ‰˜ç®¡æ¶æ„**: æ‘†è„± Supabase ä¾èµ–ï¼Œå®Œå…¨æ§åˆ¶æ•°æ®

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·å±‚ (Client Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web Browser â”‚ Mobile Browser â”‚ Desktop PWA â”‚ API Clients        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CDN å±‚ (Vercel Edge)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ å…¨çƒè¾¹ç¼˜èŠ‚ç‚¹ç¼“å­˜                                              â”‚
â”‚ â€¢ é™æ€èµ„æºåˆ†å‘ (JS/CSS/Images)                                 â”‚
â”‚ â€¢ è‡ªåŠ¨ HTTPS å’ŒåŸŸåç®¡ç†                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    åº”ç”¨å±‚ (Nuxt 4 + Nitro)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Frontend (Vue 3)        â”‚ Backend (Nitro Server)               â”‚
â”‚ â€¢ é¦–é¡µ (é—¸åˆ€äº¤äº’)       â”‚ â€¢ API Routes (/api/*)                â”‚
â”‚ â€¢ æŠ€èƒ½åœ°å›¾ (SVG)        â”‚ â€¢ è®¤è¯ç³»ç»Ÿ (Better-Auth)             â”‚
â”‚ â€¢ å…³å¡åœºæ™¯ (Wokwi)      â”‚ â€¢ ä¸šåŠ¡é€»è¾‘å¤„ç†                       â”‚
â”‚ â€¢ ç”¨æˆ·ä¸­å¿ƒ              â”‚ â€¢ æ•°æ®éªŒè¯å’Œå®‰å…¨                     â”‚
â”‚ â€¢ ç¤¾åŒºä¸­å¿ƒ              â”‚ â€¢ æ–‡ä»¶ä¸Šä¼ å¤„ç†                       â”‚
â”‚ â€¢ è“å›¾åº“                â”‚ â€¢ é‚®ä»¶æœåŠ¡é›†æˆ                       â”‚
â”‚ â€¢ ç®¡ç†åå°              â”‚ â€¢ æ”¯ä»˜å›è°ƒå¤„ç†                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å±‚ (Data Layer)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PostgreSQL (VPS)        â”‚ Cloudflare R2        â”‚ Redis (å¯é€‰)   â”‚
â”‚ â€¢ ç”¨æˆ·æ•°æ®              â”‚ â€¢ é™æ€æ–‡ä»¶å­˜å‚¨        â”‚ â€¢ ç¼“å­˜å±‚       â”‚
â”‚ â€¢ å­¦ä¹ è¿›åº¦              â”‚ â€¢ å›¾ç‰‡å’Œè§†é¢‘          â”‚ â€¢ ä¼šè¯å­˜å‚¨     â”‚
â”‚ â€¢ ç¤¾åŒºå†…å®¹              â”‚ â€¢ è“å›¾æ–‡ä»¶            â”‚ â€¢ æ’è¡Œæ¦œ       â”‚
â”‚ â€¢ ç³»ç»Ÿé…ç½®              â”‚ â€¢ å¤‡ä»½æ–‡ä»¶            â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç¬¬ä¸‰æ–¹æœåŠ¡å±‚ (External Services)             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Wokwi API              â”‚ Resend Email          â”‚ Lemon Squeezy   â”‚
â”‚ â€¢ ç”µè·¯ä»¿çœŸ             â”‚ â€¢ é‚®ä»¶å‘é€            â”‚ â€¢ æ”¯ä»˜å¤„ç†      â”‚
â”‚ â€¢ é¡¹ç›®ç®¡ç†             â”‚ â€¢ æ¨¡æ¿ç®¡ç†            â”‚ â€¢ è®¢é˜…ç®¡ç†      â”‚
â”‚                        â”‚ â€¢ é€è¾¾ç‡ç›‘æ§          â”‚ â€¢ ç¨åŠ¡å¤„ç†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OpenAI API             â”‚ LinkedIn API          â”‚ Analytics       â”‚
â”‚ â€¢ AI åŠ©æ•™              â”‚ â€¢ è¯ä¹¦é›†æˆ            â”‚ â€¢ ç”¨æˆ·è¡Œä¸º      â”‚
â”‚ â€¢ ä»£ç çº é”™             â”‚ â€¢ æŠ€èƒ½å±•ç¤º            â”‚ â€¢ æ€§èƒ½ç›‘æ§      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆé€‰å‹

#### å‰ç«¯æŠ€æœ¯æ ˆ
```typescript
const FRONTEND_STACK = {
  framework: 'Nuxt 4 (Vue 3)',
  styling: 'UnoCSS',
  stateManagement: 'Pinia',
  utilities: 'VueUse',
  icons: 'Iconify',
  animations: 'CSS Transitions + Motion One',
  
  buildTools: {
    bundler: 'Vite',
    typescript: 'TypeScript 5.0+',
    linting: 'ESLint + Prettier'
  }
}
```

#### åç«¯æŠ€æœ¯æ ˆ
```typescript
const BACKEND_STACK = {
  runtime: 'Nuxt 4 Server (Nitro)',
  database: 'PostgreSQL (è‡ªæ‰˜ç®¡)',
  orm: 'Drizzle ORM',
  authentication: 'Better-Auth',
  
  services: {
    email: 'Resend',
    storage: 'Cloudflare R2',
    payment: 'Lemon Squeezy',
    ai: 'OpenAI API (gpt-4o-mini)'
  }
}
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒæ•°æ®æ¨¡å‹

```typescript
// server/database/schema.ts
import { pgTable, text, integer, boolean, timestamp, serial, jsonb } from 'drizzle-orm/pg-core'

// ç”¨æˆ·è¡¨
export const users = pgTable('users', {
  id: text('id').primaryKey().$defaultFn(() => generateId()),
  name: text('name').notNull(),
  email: text('email').unique().notNull(),
  avatarUrl: text('avatar_url'),
  level: integer('level').default(1),
  xp: integer('xp').default(0),
  isPro: boolean('is_pro').default(false),
  role: text('role').default('user'), // 'user' | 'admin' | 'super_admin'
  adminRole: text('admin_role'), // ç®¡ç†å‘˜æƒé™ç­‰çº§
  createdAt: timestamp('created_at').defaultNow(),
  lastActiveAt: timestamp('last_active_at').defaultNow()
})

// OAuth è´¦å·å…³è”è¡¨
export const accounts = pgTable('accounts', {
  id: text('id').primaryKey(),
  userId: text('user_id').references(() => users.id),
  provider: text('provider').notNull(), // 'google', 'github'
  providerAccountId: text('provider_account_id').notNull(),
  accessToken: text('access_token'),
  refreshToken: text('refresh_token'),
  expiresAt: timestamp('expires_at')
})

// å­¦ä¹ è¿›åº¦è¡¨
export const progress = pgTable('progress', {
  id: serial('id').primaryKey(),
  userId: text('user_id').references(() => users.id),
  lessonId: text('lesson_id').notNull(),
  phase: text('phase'), // 'theory', 'practice', 'debug', 'reflection'
  status: text('status'), // 'locked', 'active', 'completed'
  score: integer('score'),
  completedAt: timestamp('completed_at'),
  createdAt: timestamp('created_at').defaultNow()
})

// è“å›¾è¡¨
export const blueprints = pgTable('blueprints', {
  id: serial('id').primaryKey(),
  title: text('title').notNull(),
  description: text('description'),
  difficulty: text('difficulty'), // 'beginner' | 'intermediate' | 'advanced'
  category: text('category'),
  tags: text('tags').array(),
  coverImage: text('cover_image'),
  wokwiProjectId: text('wokwi_project_id'),
  bomData: jsonb('bom_data'),
  affiliateLinks: jsonb('affiliate_links'),
  downloadUrl: text('download_url'),
  hasProContent: boolean('has_pro_content').default(false),
  isOfficial: boolean('is_official').default(true),
  downloads: integer('downloads').default(0),
  rating: integer('rating').default(0),
  createdAt: timestamp('created_at').defaultNow()
})

// è¯ä¹¦è¡¨
export const certificates = pgTable('certificates', {
  id: text('id').primaryKey(), // 8ä½çŸ­ID
  userId: text('user_id').references(() => users.id),
  badgeType: text('badge_type').notNull(),
  issuedAt: timestamp('issued_at').defaultNow(),
  verifyHash: text('verify_hash').notNull(),
  isRevoked: boolean('is_revoked').default(false)
})

// ç¤¾åŒºå¸–å­è¡¨
export const communityPosts = pgTable('community_posts', {
  id: text('id').primaryKey(),
  userId: text('user_id').references(() => users.id),
  title: text('title').notNull(),
  content: text('content').notNull(),
  type: text('type'), // 'project', 'discussion', 'help'
  wokwiProjectId: text('wokwi_project_id'),
  images: text('images').array(),
  tags: text('tags').array(),
  likes: integer('likes').default(0),
  replies: integer('replies').default(0),
  status: text('status').default('published'), // 'draft', 'published', 'archived'
  createdAt: timestamp('created_at').defaultNow()
})

// å…³å¡é…ç½®è¡¨ (CMS)
export const lessonConfigs = pgTable('lesson_configs', {
  id: text('id').primaryKey(),
  title: text('title').notNull(),
  description: text('description'),
  difficulty: text('difficulty'),
  category: text('category'),
  config: jsonb('config'), // å®Œæ•´çš„å…³å¡é…ç½®JSON
  status: text('status').default('draft'), // 'draft', 'published', 'archived'
  version: integer('version').default(1),
  createdBy: text('created_by').references(() => users.id),
  createdAt: timestamp('created_at').defaultNow(),
  publishedAt: timestamp('published_at')
})

// å¤‡ä»½æ—¥å¿—è¡¨
export const backupLogs = pgTable('backup_logs', {
  id: text('id').primaryKey(),
  type: text('type').notNull(), // 'manual', 'scheduled', 'restore'
  status: text('status').notNull(), // 'completed', 'failed'
  fileSize: text('file_size'),
  error: text('error'),
  createdBy: text('created_by'),
  createdAt: timestamp('created_at').defaultNow()
})
```

### æ•°æ®åº“è¿æ¥é…ç½®

```typescript
// server/database/connection.ts
import { drizzle } from 'drizzle-orm/postgres-js'
import postgres from 'postgres'

const DATABASE_CONFIG = {
  connectionPool: {
    host: process.env.DATABASE_HOST,
    port: 5432,
    database: process.env.DATABASE_NAME,
    user: process.env.DATABASE_USER,
    password: process.env.DATABASE_PASSWORD,
    
    // è¿æ¥æ± è®¾ç½®
    max: 15, // æœ€å¤§è¿æ¥æ•°
    min: 2,  // æœ€å°è¿æ¥æ•°
    idle: 30000, // ç©ºé—²è¶…æ—¶ 30s
    acquire: 60000, // è·å–è¿æ¥è¶…æ—¶ 60s
    
    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
  }
}

const queryClient = postgres(process.env.DATABASE_URL!, DATABASE_CONFIG.connectionPool)
export const db = drizzle(queryClient)
```

## ğŸ” è®¤è¯ç³»ç»Ÿæ¶æ„

### Better-Auth é…ç½®

```typescript
// server/api/auth/[...].ts
import { betterAuth } from "better-auth"
import { drizzleAdapter } from "better-auth/adapters/drizzle"
import { db } from "~/server/database/connection"

export const auth = betterAuth({
  database: drizzleAdapter(db, {
    provider: "pg"
  }),
  
  // æµ·å¤–å¸‚åœºæ ‡é…ï¼šEmail + OAuth
  socialProviders: {
    google: {
      clientId: process.env.GOOGLE_CLIENT_ID!,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,
    },
    github: {
      clientId: process.env.GITHUB_CLIENT_ID!,
      clientSecret: process.env.GITHUB_CLIENT_SECRET!,
    }
  },
  
  // Magic Link ç™»å½•ï¼ˆæµ·å¤–ç”¨æˆ·åå¥½ï¼‰
  emailAndPassword: {
    enabled: true,
    requireEmailVerification: true,
    sendResetPassword: async ({ user, url }) => {
      await sendEmail({
        to: user.email,
        subject: 'Reset Your KNZN Password',
        template: 'password-reset',
        data: { resetUrl: url, userName: user.name }
      })
    }
  },
  
  magicLink: {
    enabled: true,
    sendMagicLink: async ({ email, url }) => {
      await sendEmail({
        to: email,
        subject: 'Sign in to KNZN',
        template: 'magic-link',
        data: { loginUrl: url }
      })
    }
  },
  
  session: {
    cookieCache: {
      enabled: true,
      maxAge: 60 * 60 * 24 * 7 // 7 days
    }
  },
  
  // GDPR åˆè§„é…ç½®
  user: {
    deleteUser: {
      enabled: true,
    },
    changeEmail: {
      enabled: true,
      requireEmailVerification: true
    }
  }
})
```

### æƒé™ç®¡ç†ç³»ç»Ÿ

```typescript
// server/middleware/admin-auth.ts
export default defineEventHandler(async (event) => {
  if (!event.node.req.url?.startsWith('/admin')) return
  
  const session = await getUserSession(event)
  if (!session) {
    throw createError({
      statusCode: 401,
      statusMessage: 'Admin authentication required'
    })
  }
  
  const user = await db.select()
    .from(users)
    .where(eq(users.id, session.user.id))
    .limit(1)
  
  if (!user.length || !user[0].adminRole) {
    throw createError({
      statusCode: 403,
      statusMessage: 'Admin access denied'
    })
  }
  
  event.context.admin = {
    id: user[0].id,
    role: user[0].adminRole,
    permissions: getAdminPermissions(user[0].adminRole)
  }
})

enum AdminRole {
  SUPER_ADMIN = 'super_admin',     // è¶…çº§ç®¡ç†å‘˜ï¼šæ‰€æœ‰æƒé™
  CONTENT_ADMIN = 'content_admin', // å†…å®¹ç®¡ç†å‘˜ï¼šå†…å®¹å®¡æ ¸ã€è“å›¾ç®¡ç†
  SUPPORT_ADMIN = 'support_admin', // å®¢æœç®¡ç†å‘˜ï¼šç”¨æˆ·æ”¯æŒã€ç”³è¯‰å¤„ç†
  READONLY_ADMIN = 'readonly_admin' // åªè¯»ç®¡ç†å‘˜ï¼šä»…æŸ¥çœ‹æ•°æ®
}
```

## ğŸ“§ é‚®ä»¶æœåŠ¡æ¶æ„

### Resend é›†æˆé…ç½®

```typescript
// server/utils/email.ts
const EMAIL_CONFIG = {
  provider: 'resend',
  apiKey: process.env.RESEND_API_KEY,
  fromDomain: 'knzn.net',
  
  // å¿…é¡»é…ç½® DKIM å’Œ SPFï¼Œé˜²æ­¢è¿›åƒåœ¾ç®±
  dnsRecords: {
    spf: 'v=spf1 include:_spf.resend.com ~all',
    dkim: 'resend._domainkey.knzn.net',
    dmarc: 'v=DMARC1; p=quarantine; rua=mailto:dmarc@knzn.net'
  },
  
  // é‚®ä»¶æ¨¡æ¿ï¼ˆå¤šè¯­è¨€æ”¯æŒï¼‰
  templates: {
    welcome: {
      subject: 'Welcome to KNZN - Your Hardware Learning Journey Begins!',
      template: 'welcome-email.html'
    },
    magicLink: {
      subject: 'Sign in to KNZN',
      template: 'magic-link.html'
    },
    passwordReset: {
      subject: 'Reset Your KNZN Password',
      template: 'password-reset.html'
    },
    courseProgress: {
      subject: 'Great Progress! You completed {courseName}',
      template: 'course-progress.html'
    },
    certificate: {
      subject: 'Your KNZN Certificate is Ready!',
      template: 'certificate-ready.html',
      attachments: true // PDF è¯ä¹¦
    }
  },
  
  // å‘é€é¢‘ç‡é™åˆ¶ï¼ˆé˜²æ­¢è¢«æ ‡è®°ä¸ºåƒåœ¾é‚®ä»¶ï¼‰
  rateLimiting: {
    perUser: 10, // æ¯ç”¨æˆ·æ¯å°æ—¶æœ€å¤š 10 å°
    perDomain: 1000, // æ¯åŸŸåæ¯å°æ—¶æœ€å¤š 1000 å°
    cooldown: 60 // åŒç±»é‚®ä»¶é—´éš” 60 ç§’
  }
}

// é‚®ä»¶å‘é€å°è£…
const sendEmail = async (options: {
  to: string
  template: string
  data: Record<string, any>
  attachments?: Buffer[]
}) => {
  try {
    const response = await fetch('https://api.resend.com/emails', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${process.env.RESEND_API_KEY}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        from: 'KNZN <noreply@knzn.net>',
        to: options.to,
        subject: EMAIL_CONFIG.templates[options.template].subject,
        html: await renderTemplate(options.template, options.data),
        attachments: options.attachments
      })
    })
    
    if (!response.ok) {
      throw new Error(`Email sending failed: ${response.statusText}`)
    }
    
    return await response.json()
  } catch (error) {
    console.error('Email sending error:', error)
    throw error
  }
}
```

## ğŸ’³ æ”¯ä»˜ç³»ç»Ÿæ¶æ„

### Lemon Squeezy é›†æˆ

```typescript
// server/api/webhook/lemon-squeezy.post.ts
export default defineEventHandler(async (event) => {
  const body = await readBody(event)
  const signature = getHeader(event, 'x-signature')
  
  // éªŒè¯ webhook ç­¾å
  if (!verifyLemonSqueezySignature(body, signature)) {
    throw createError({
      statusCode: 401,
      statusMessage: 'Invalid signature'
    })
  }
  
  const { event_name, data } = body
  
  switch (event_name) {
    case 'subscription_created':
      await handleSubscriptionCreated(data)
      break
    case 'subscription_updated':
      await handleSubscriptionUpdated(data)
      break
    case 'subscription_cancelled':
      await handleSubscriptionCancelled(data)
      break
    case 'subscription_resumed':
      await handleSubscriptionResumed(data)
      break
  }
  
  return { success: true }
})

const handleSubscriptionCreated = async (data: any) => {
  const { customer_id, status, product_name } = data.attributes
  
  // æ ¹æ® customer_id æ‰¾åˆ°ç”¨æˆ·
  const user = await db.select()
    .from(users)
    .where(eq(users.email, customer_id))
    .limit(1)
  
  if (user.length) {
    await db.update(users)
      .set({ 
        isPro: true,
        proSubscriptionStatus: status,
        proSubscriptionPlan: product_name
      })
      .where(eq(users.id, user[0].id))
  }
}
```

## ğŸ—‚ï¸ æ–‡ä»¶å­˜å‚¨æ¶æ„

### Cloudflare R2 é…ç½®

```typescript
// server/utils/storage.ts
import { S3Client, PutObjectCommand, GetObjectCommand } from '@aws-sdk/client-s3'
import { getSignedUrl } from '@aws-sdk/s3-request-presigner'

const r2Client = new S3Client({
  region: 'auto',
  endpoint: `https://${process.env.CLOUDFLARE_ACCOUNT_ID}.r2.cloudflarestorage.com`,
  credentials: {
    accessKeyId: process.env.R2_ACCESS_KEY_ID!,
    secretAccessKey: process.env.R2_SECRET_ACCESS_KEY!,
  },
})

// ç”Ÿæˆé¢„ç­¾åä¸Šä¼  URL
export const generateUploadUrl = async (fileName: string, contentType: string) => {
  const command = new PutObjectCommand({
    Bucket: 'knzn-assets',
    Key: `uploads/${Date.now()}-${fileName}`,
    ContentType: contentType,
  })
  
  return await getSignedUrl(r2Client, command, { expiresIn: 300 }) // 5åˆ†é’Ÿæœ‰æ•ˆ
}

// æ–‡ä»¶ä¸Šä¼ å¤„ç†
// server/api/upload/presign.post.ts
export default defineEventHandler(async (event) => {
  const body = await readBody(event)
  const { fileName, fileType, fileSize } = body
  
  // éªŒè¯ç”¨æˆ·æƒé™
  const session = await getUserSession(event)
  if (!session) {
    throw createError({ statusCode: 401, statusMessage: 'Unauthorized' })
  }
  
  // éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°
  const allowedTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif']
  if (!allowedTypes.includes(fileType)) {
    throw createError({ statusCode: 400, statusMessage: 'Invalid file type' })
  }
  
  if (fileSize > 500 * 1024) { // 500KB é™åˆ¶
    throw createError({ statusCode: 400, statusMessage: 'File too large' })
  }
  
  const presignedUrl = await generateUploadUrl(fileName, fileType)
  
  return { presignedUrl }
})
```

## ğŸ”„ æ•°æ®å¤‡ä»½ä¸å®¹ç¾

### è‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿ

```bash
#!/bin/bash
# è‡ªåŠ¨å¤‡ä»½è„šæœ¬ - /scripts/backup.sh

# é…ç½®å˜é‡
BACKUP_DIR="/tmp/backups"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="knzn_production"
BACKUP_FILE="knzn_backup_${DATE}.sql"
ENCRYPTED_FILE="${BACKUP_FILE}.gz.enc"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# 1. æ‰§è¡Œæ•°æ®åº“å¤‡ä»½
echo "Starting database backup..."
pg_dump $DATABASE_URL > $BACKUP_DIR/$BACKUP_FILE

# æ£€æŸ¥å¤‡ä»½æ˜¯å¦æˆåŠŸ
if [ $? -eq 0 ]; then
    echo "Database backup completed: $BACKUP_FILE"
else
    echo "Database backup failed!"
    exit 1
fi

# 2. å‹ç¼©å¤‡ä»½æ–‡ä»¶
echo "Compressing backup..."
gzip $BACKUP_DIR/$BACKUP_FILE

# 3. åŠ å¯†å‹ç¼©æ–‡ä»¶
echo "Encrypting backup..."
openssl enc -aes-256-cbc -salt \
    -in $BACKUP_DIR/${BACKUP_FILE}.gz \
    -out $BACKUP_DIR/$ENCRYPTED_FILE \
    -k $BACKUP_PASSWORD

# 4. ä¸Šä¼ åˆ° Cloudflare R2
echo "Uploading to R2..."
aws s3 cp $BACKUP_DIR/$ENCRYPTED_FILE \
    s3://knzn-backups/database/$ENCRYPTED_FILE \
    --endpoint-url https://$CLOUDFLARE_ACCOUNT_ID.r2.cloudflarestorage.com

# 5. æ¸…ç†æœ¬åœ°æ–‡ä»¶
rm $BACKUP_DIR/${BACKUP_FILE}.gz
rm $BACKUP_DIR/$ENCRYPTED_FILE

# 6. æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™30å¤©ï¼‰
aws s3 ls s3://knzn-backups/database/ \
    --endpoint-url https://$CLOUDFLARE_ACCOUNT_ID.r2.cloudflarestorage.com \
    | awk '$1 < "'$(date -d '30 days ago' '+%Y-%m-%d')'" {print $4}' \
    | xargs -I {} aws s3 rm s3://knzn-backups/database/{} \
    --endpoint-url https://$CLOUDFLARE_ACCOUNT_ID.r2.cloudflarestorage.com

echo "Backup completed successfully: $ENCRYPTED_FILE"
```

### Cron Job é…ç½®

```typescript
// server/tasks/backup.ts
import cron from 'node-cron'

// æ¯å¤©å‡Œæ™¨ 2 ç‚¹æ‰§è¡Œå¤‡ä»½
cron.schedule('0 2 * * *', async () => {
  console.log('Starting scheduled backup...')
  
  try {
    await execAsync('/scripts/backup.sh')
    
    // è®°å½•æˆåŠŸæ—¥å¿—
    await db.insert(backupLogs).values({
      id: nanoid(),
      type: 'scheduled',
      status: 'completed',
      createdAt: new Date()
    })
    
    console.log('Scheduled backup completed successfully')
  } catch (error) {
    console.error('Scheduled backup failed:', error)
    
    // è®°å½•å¤±è´¥æ—¥å¿—
    await db.insert(backupLogs).values({
      id: nanoid(),
      type: 'scheduled',
      status: 'failed',
      error: error.message,
      createdAt: new Date()
    })
    
    // å‘é€å‘Šè­¦é‚®ä»¶
    await sendAlertEmail('Backup Failed', error.message)
  }
}, {
  timezone: 'UTC'
})
```

## ğŸš€ éƒ¨ç½²æ¶æ„

### Vercel éƒ¨ç½²é…ç½®

```json
// vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "nuxt.config.ts",
      "use": "@nuxtjs/vercel-builder"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/"
    }
  ],
  "env": {
    "DATABASE_URL": "@database_url",
    "GOOGLE_CLIENT_ID": "@google_client_id",
    "GOOGLE_CLIENT_SECRET": "@google_client_secret",
    "GITHUB_CLIENT_ID": "@github_client_id",
    "GITHUB_CLIENT_SECRET": "@github_client_secret",
    "RESEND_API_KEY": "@resend_api_key",
    "OPENAI_API_KEY": "@openai_api_key",
    "R2_ACCESS_KEY_ID": "@r2_access_key_id",
    "R2_SECRET_ACCESS_KEY": "@r2_secret_access_key",
    "CLOUDFLARE_ACCOUNT_ID": "@cloudflare_account_id",
    "LEMON_SQUEEZY_API_KEY": "@lemon_squeezy_api_key",
    "BACKUP_PASSWORD": "@backup_password"
  },
  "functions": {
    "server/api/**/*.ts": {
      "maxDuration": 30
    }
  }
}
```

### Nuxt é…ç½®

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  devtools: { enabled: true },
  
  // æ¨¡å—é…ç½®
  modules: [
    '@nuxtjs/tailwindcss',
    '@pinia/nuxt',
    '@vueuse/nuxt',
    '@nuxtjs/google-fonts'
  ],
  
  // CSS é…ç½®
  css: [
    '@unocss/reset/tailwind.css',
    '~/assets/css/main.css'
  ],
  
  // è¿è¡Œæ—¶é…ç½®
  runtimeConfig: {
    // ç§æœ‰é…ç½®ï¼ˆä»…æœåŠ¡ç«¯ï¼‰
    databaseUrl: process.env.DATABASE_URL,
    googleClientId: process.env.GOOGLE_CLIENT_ID,
    googleClientSecret: process.env.GOOGLE_CLIENT_SECRET,
    githubClientId: process.env.GITHUB_CLIENT_ID,
    githubClientSecret: process.env.GITHUB_CLIENT_SECRET,
    resendApiKey: process.env.RESEND_API_KEY,
    openaiApiKey: process.env.OPENAI_API_KEY,
    r2AccessKeyId: process.env.R2_ACCESS_KEY_ID,
    r2SecretAccessKey: process.env.R2_SECRET_ACCESS_KEY,
    cloudflareAccountId: process.env.CLOUDFLARE_ACCOUNT_ID,
    lemonSqueezyApiKey: process.env.LEMON_SQUEEZY_API_KEY,
    backupPassword: process.env.BACKUP_PASSWORD,
    
    // å…¬å…±é…ç½®ï¼ˆå®¢æˆ·ç«¯å¯è®¿é—®ï¼‰
    public: {
      siteUrl: process.env.SITE_URL || 'https://knzn.net',
      wokwiApiUrl: 'https://wokwi.com/api'
    }
  },
  
  // Nitro é…ç½®
  nitro: {
    experimental: {
      wasm: true
    },
    storage: {
      redis: {
        driver: 'redis',
        // Redis é…ç½®ï¼ˆå¯é€‰ï¼‰
      }
    }
  },
  
  // æ„å»ºé…ç½®
  build: {
    transpile: ['@headlessui/vue']
  },
  
  // æœåŠ¡ç«¯æ¸²æŸ“é…ç½®
  ssr: true,
  
  // é¢„æ¸²æŸ“é…ç½®
  prerender: {
    routes: ['/']
  }
})
```

### VPS PostgreSQL éƒ¨ç½²

```bash
# PostgreSQL å®‰è£…å’Œé…ç½®è„šæœ¬
#!/bin/bash

# 1. å®‰è£… PostgreSQL
sudo apt update
sudo apt install postgresql postgresql-contrib

# 2. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo -u postgres psql << EOF
CREATE DATABASE knzn_production;
CREATE USER knzn_user WITH ENCRYPTED PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE knzn_production TO knzn_user;
ALTER USER knzn_user CREATEDB;
\q
EOF

# 3. é…ç½® PostgreSQL
sudo nano /etc/postgresql/14/main/postgresql.conf
# ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š
# listen_addresses = '*'
# max_connections = 100
# shared_buffers = 256MB
# effective_cache_size = 1GB

sudo nano /etc/postgresql/14/main/pg_hba.conf
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
# host knzn_production knzn_user 0.0.0.0/0 md5

# 4. é‡å¯ PostgreSQL
sudo systemctl restart postgresql
sudo systemctl enable postgresql

# 5. é…ç½®é˜²ç«å¢™
sudo ufw allow 5432/tcp

# 6. åˆ›å»ºå¤‡ä»½ç›®å½•
sudo mkdir -p /var/backups/postgresql
sudo chown postgres:postgres /var/backups/postgresql
```

## ğŸ”’ å®‰å…¨é…ç½®

### HTTPS å’ŒåŸŸåé…ç½®

```typescript
// server/middleware/security.ts
export default defineEventHandler(async (event) => {
  // è®¾ç½®å®‰å…¨å¤´
  setHeader(event, 'X-Content-Type-Options', 'nosniff')
  setHeader(event, 'X-Frame-Options', 'DENY')
  setHeader(event, 'X-XSS-Protection', '1; mode=block')
  setHeader(event, 'Referrer-Policy', 'strict-origin-when-cross-origin')
  setHeader(event, 'Permissions-Policy', 'camera=(), microphone=(), geolocation=()')
  
  // HSTS (ä»…åœ¨ç”Ÿäº§ç¯å¢ƒ)
  if (process.env.NODE_ENV === 'production') {
    setHeader(event, 'Strict-Transport-Security', 'max-age=31536000; includeSubDomains')
  }
  
  // CSP é…ç½®
  const csp = [
    "default-src 'self'",
    "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://wokwi.com https://www.googletagmanager.com",
    "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com",
    "font-src 'self' https://fonts.gstatic.com",
    "img-src 'self' data: https: blob:",
    "media-src 'self' https:",
    "connect-src 'self' https://api.resend.com https://api.openai.com https://wokwi.com",
    "frame-src 'self' https://wokwi.com https://knzn.lemonsqueezy.com",
    "object-src 'none'",
    "base-uri 'self'"
  ].join('; ')
  
  setHeader(event, 'Content-Security-Policy', csp)
})
```

### ç¯å¢ƒå˜é‡ç®¡ç†

```bash
# .env.example
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://knzn_user:password@localhost:5432/knzn_production"

# OAuth é…ç½®
GOOGLE_CLIENT_ID="your_google_client_id"
GOOGLE_CLIENT_SECRET="your_google_client_secret"
GITHUB_CLIENT_ID="your_github_client_id"
GITHUB_CLIENT_SECRET="your_github_client_secret"

# é‚®ä»¶æœåŠ¡
RESEND_API_KEY="re_your_resend_api_key"

# AI æœåŠ¡
OPENAI_API_KEY="sk-your_openai_api_key"

# æ–‡ä»¶å­˜å‚¨
R2_ACCESS_KEY_ID="your_r2_access_key"
R2_SECRET_ACCESS_KEY="your_r2_secret_key"
CLOUDFLARE_ACCOUNT_ID="your_cloudflare_account_id"

# æ”¯ä»˜æœåŠ¡
LEMON_SQUEEZY_API_KEY="your_lemon_squeezy_api_key"

# å¤‡ä»½åŠ å¯†
BACKUP_PASSWORD="your_backup_encryption_password"

# ç«™ç‚¹é…ç½®
SITE_URL="https://knzn.net"
```

## ğŸ“Š ç›‘æ§ä¸åˆ†æ

### ç³»ç»Ÿç›‘æ§é…ç½®

```typescript
// server/utils/monitoring.ts
const SYSTEM_MONITORING = {
  // æ•°æ®åº“ç›‘æ§
  database: {
    connectionPool: {
      current: () => db.pool.totalCount,
      max: () => db.pool.options.max,
      idle: () => db.pool.idleCount,
      waiting: () => db.pool.waitingCount
    },
    
    slowQueries: async () => {
      return await db.execute(sql`
        SELECT query, mean_exec_time, calls, total_exec_time
        FROM pg_stat_statements 
        WHERE mean_exec_time > 1000 
        ORDER BY mean_exec_time DESC 
        LIMIT 10
      `)
    }
  },
  
  // é”™è¯¯ç›‘æ§
  errorTracking: {
    recentErrors: async (hours: number = 24) => {
      return await db.select()
        .from(errorLogs)
        .where(sql`created_at > NOW() - INTERVAL '${hours} hours'`)
        .orderBy(desc(errorLogs.createdAt))
        .limit(100)
    }
  },
  
  // Wokwi API ç›‘æ§
  wokwiMonitoring: {
    apiCalls: {
      total: 0,
      successful: 0,
      failed: 0,
      avgResponseTime: 0
    }
  }
}
```

### æ€§èƒ½ä¼˜åŒ–é…ç½®

```typescript
// server/middleware/performance.ts
export default defineEventHandler(async (event) => {
  const startTime = Date.now()
  
  // å“åº”å®Œæˆåè®°å½•æ€§èƒ½æŒ‡æ ‡
  event.node.res.on('finish', () => {
    const duration = Date.now() - startTime
    const url = event.node.req.url
    const method = event.node.req.method
    const statusCode = event.node.res.statusCode
    
    // è®°å½•æ…¢è¯·æ±‚
    if (duration > 1000) {
      console.warn(`Slow request: ${method} ${url} - ${duration}ms`)
    }
    
    // è®°å½•é”™è¯¯è¯·æ±‚
    if (statusCode >= 400) {
      console.error(`Error request: ${method} ${url} - ${statusCode}`)
    }
  })
})
```

## ğŸŒ GDPR åˆè§„é…ç½®

### éšç§åˆè§„ç³»ç»Ÿ

```typescript
// server/utils/privacy.ts
const PRIVACY_COMPLIANCE = {
  cookieConsent: {
    enabled: true,
    
    categories: {
      necessary: {
        name: 'Strictly Necessary',
        description: 'Essential for the website to function',
        required: true,
        cookies: ['session', 'csrf-token', 'auth-state']
      },
      analytics: {
        name: 'Analytics',
        description: 'Help us understand how you use our site',
        required: false,
        cookies: ['_ga', '_gid', 'gtag']
      }
    }
  },
  
  // ç”¨æˆ·æƒåˆ©å®ç°
  userRights: {
    // æ•°æ®å¯¼å‡ºæƒï¼ˆGDPR Article 20ï¼‰
    dataExport: {
      endpoint: '/api/privacy/export-data',
      formats: ['json', 'csv'],
      includeData: [
        'profile', 'progress', 'certificates', 
        'posts', 'comments', 'achievements'
      ]
    },
    
    // åˆ é™¤æƒï¼ˆGDPR Article 17ï¼‰
    dataDelete: {
      endpoint: '/api/privacy/delete-account',
      confirmationRequired: true,
      gracePeriod: 30, // 30 å¤©å†…å¯æ¢å¤
      anonymizeData: true
    }
  }
}

// æ•°æ®å¯¼å‡º API
// server/api/privacy/export-data.post.ts
export default defineEventHandler(async (event) => {
  const session = await getUserSession(event)
  if (!session) {
    throw createError({ statusCode: 401, statusMessage: 'Unauthorized' })
  }
  
  const userId = session.user.id
  
  // æ”¶é›†ç”¨æˆ·æ•°æ®
  const userData = {
    profile: await getUserProfile(userId),
    progress: await getUserProgress(userId),
    certificates: await getUserCertificates(userId),
    posts: await getUserPosts(userId),
    comments: await getUserComments(userId)
  }
  
  // ç”Ÿæˆå¯¼å‡ºæ–‡ä»¶
  const exportData = JSON.stringify(userData, null, 2)
  
  return {
    data: exportData,
    exportedAt: new Date().toISOString(),
    format: 'json'
  }
})
```

## ğŸ“ˆ æ‰©å±•æ€§è®¾è®¡

### å¾®æœåŠ¡æ¶æ„å‡†å¤‡

```typescript
// ä¸ºæœªæ¥å¾®æœåŠ¡åŒ–åšå‡†å¤‡çš„æ¨¡å—åŒ–è®¾è®¡
const SERVICE_MODULES = {
  auth: {
    path: '/server/services/auth',
    responsibilities: ['ç”¨æˆ·è®¤è¯', 'æƒé™ç®¡ç†', 'ä¼šè¯ç®¡ç†']
  },
  
  learning: {
    path: '/server/services/learning',
    responsibilities: ['å…³å¡ç®¡ç†', 'è¿›åº¦è·Ÿè¸ª', 'æˆå°±ç³»ç»Ÿ']
  },
  
  community: {
    path: '/server/services/community',
    responsibilities: ['ç¤¾åŒºå†…å®¹', 'ç”¨æˆ·äº’åŠ¨', 'å†…å®¹å®¡æ ¸']
  },
  
  payment: {
    path: '/server/services/payment',
    responsibilities: ['è®¢é˜…ç®¡ç†', 'æ”¯ä»˜å¤„ç†', 'å‘ç¥¨ç”Ÿæˆ']
  },
  
  notification: {
    path: '/server/services/notification',
    responsibilities: ['é‚®ä»¶å‘é€', 'æ¨é€é€šçŸ¥', 'æ¶ˆæ¯é˜Ÿåˆ—']
  }
}
```

### ç¼“å­˜ç­–ç•¥

```typescript
// server/utils/cache.ts
const CACHE_STRATEGY = {
  redis: {
    enabled: process.env.REDIS_URL ? true : false,
    ttl: {
      userSession: 3600, // 1å°æ—¶
      leaderboard: 3600, // 1å°æ—¶
      blueprints: 86400, // 24å°æ—¶
      userProgress: 300 // 5åˆ†é’Ÿ
    }
  },
  
  memory: {
    enabled: true,
    maxSize: 100, // 100MB
    ttl: 300 // 5åˆ†é’Ÿ
  }
}

// ç¼“å­˜è£…é¥°å™¨
export const cached = (ttl: number = 300) => {
  return (target: any, propertyKey: string, descriptor: PropertyDescriptor) => {
    const originalMethod = descriptor.value
    
    descriptor.value = async function (...args: any[]) {
      const cacheKey = `${propertyKey}:${JSON.stringify(args)}`
      
      // å°è¯•ä»ç¼“å­˜è·å–
      const cached = await getFromCache(cacheKey)
      if (cached) return cached
      
      // æ‰§è¡ŒåŸæ–¹æ³•
      const result = await originalMethod.apply(this, args)
      
      // å­˜å…¥ç¼“å­˜
      await setCache(cacheKey, result, ttl)
      
      return result
    }
  }
}
```

## ğŸš€ éƒ¨ç½²æµç¨‹

### CI/CD é…ç½®

```yaml
# .github/workflows/deploy.yml
name: Deploy to Vercel

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm run test
    
    - name: Build application
      run: npm run build
    
    - name: Deploy to Vercel
      uses: vercel/action@v1
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
        vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
```

### éƒ¨ç½²æ£€æŸ¥æ¸…å•

```markdown
## éƒ¨ç½²å‰æ£€æŸ¥æ¸…å•

### ç¯å¢ƒé…ç½®
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²åœ¨ Vercel ä¸­é…ç½®
- [ ] PostgreSQL æ•°æ®åº“å·²éƒ¨ç½²å¹¶å¯è®¿é—®
- [ ] Cloudflare R2 å­˜å‚¨æ¡¶å·²åˆ›å»º
- [ ] DNS è®°å½•å·²æ­£ç¡®é…ç½®

### ç¬¬ä¸‰æ–¹æœåŠ¡
- [ ] Google OAuth åº”ç”¨å·²é…ç½®
- [ ] GitHub OAuth åº”ç”¨å·²é…ç½®
- [ ] Resend é‚®ä»¶æœåŠ¡å·²é…ç½®
- [ ] OpenAI API å¯†é’¥å·²è·å–
- [ ] Lemon Squeezy å•†æˆ·å·²è®¾ç½®

### å®‰å…¨é…ç½®
- [ ] HTTPS è¯ä¹¦å·²é…ç½®
- [ ] å®‰å…¨å¤´å·²è®¾ç½®
- [ ] CORS ç­–ç•¥å·²é…ç½®
- [ ] å¤‡ä»½ç³»ç»Ÿå·²æµ‹è¯•

### åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•æµç¨‹
- [ ] é‚®ä»¶å‘é€åŠŸèƒ½
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] æ”¯ä»˜å›è°ƒå¤„ç†
- [ ] æ•°æ®åº“å¤‡ä»½æ¢å¤

### æ€§èƒ½ä¼˜åŒ–
- [ ] é™æ€èµ„æº CDN é…ç½®
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥å®æ–½
- [ ] å›¾ç‰‡å‹ç¼©é…ç½®
```

## ğŸ“Š æˆæœ¬é¢„ç®—

### è¿è¥æˆæœ¬ä¼°ç®—ï¼ˆæœˆåº¦ï¼‰

```typescript
const MONTHLY_COSTS = {
  // åŸºç¡€è®¾æ–½
  vercel: {
    plan: 'Pro',
    cost: 20, // $20/æœˆ
    description: 'æ— é™å¸¦å®½ï¼Œè¾¹ç¼˜å‡½æ•°ï¼Œåˆ†æ'
  },
  
  vps: {
    provider: 'DigitalOcean/Linode',
    plan: '2GB RAM, 1 CPU',
    cost: 12, // $12/æœˆ
    description: 'PostgreSQL æ•°æ®åº“æœåŠ¡å™¨'
  },
  
  cloudflareR2: {
    storage: '10GB',
    bandwidth: '100GB',
    cost: 5, // ~$5/æœˆ
    description: 'æ–‡ä»¶å­˜å‚¨å’Œ CDN'
  },
  
  // ç¬¬ä¸‰æ–¹æœåŠ¡
  resend: {
    plan: 'Pro',
    emails: '50,000/æœˆ',
    cost: 20, // $20/æœˆ
    description: 'é‚®ä»¶å‘é€æœåŠ¡'
  },
  
  openai: {
    usage: 'gpt-4o-mini',
    tokens: '1M tokens/æœˆ',
    cost: 15, // ~$15/æœˆ
    description: 'AI åŠ©æ•™æœåŠ¡'
  },
  
  lemonSqueezy: {
    commission: '5% + $0.50',
    cost: 0, // æŒ‰äº¤æ˜“æ”¶è´¹
    description: 'æ”¯ä»˜å¤„ç†ï¼ˆä»æ”¶å…¥ä¸­æ‰£é™¤ï¼‰'
  },
  
  // æ€»è®¡
  total: 72, // $72/æœˆ
  
  // æ”¶å…¥ç›®æ ‡
  revenue: {
    proSubscriptions: 500 * 9.99, // 500ä¸ªProç”¨æˆ· * $9.99
    affiliateCommission: 500, // è”ç›Ÿè¥é”€ä½£é‡‘
    total: 5495 // $5,495/æœˆ
  },
  
  // å‡€åˆ©æ¶¦
  netProfit: 5495 - 72, // $5,423/æœˆ
  profitMargin: '98.7%'
}
```

## ğŸ“‹ å¼€å‘æ—¶é—´è¡¨

### MVP å¼€å‘è®¡åˆ’ï¼ˆ12å‘¨ï¼‰

```typescript
const DEVELOPMENT_TIMELINE = {
  // Phase 1: åŸºç¡€æ¶æ„ (Week 1-3)
  phase1: {
    duration: '3 weeks',
    tasks: [
      'Nuxt 4 é¡¹ç›®åˆå§‹åŒ–',
      'PostgreSQL + Drizzle ORM é…ç½®',
      'Better-Auth é›†æˆ',
      'Vercel éƒ¨ç½²é…ç½®',
      'åŸºç¡€ UI ç»„ä»¶åº“'
    ]
  },
  
  // Phase 2: æ ¸å¿ƒåŠŸèƒ½ (Week 4-7)
  phase2: {
    duration: '4 weeks',
    tasks: [
      'é¦–é¡µé—¸åˆ€äº¤äº’',
      'æŠ€èƒ½åœ°å›¾ SVG ç‰ˆæœ¬',
      'å…³å¡åœºæ™¯ + Wokwi é›†æˆ',
      'ç”¨æˆ·ä¸­å¿ƒé¡µé¢',
      'è“å›¾åº“åŸºç¡€åŠŸèƒ½'
    ]
  },
  
  // Phase 3: å•†ä¸šåŒ–åŠŸèƒ½ (Week 8-10)
  phase3: {
    duration: '3 weeks',
    tasks: [
      'Lemon Squeezy æ”¯ä»˜é›†æˆ',
      'è®¤è¯ç³»ç»Ÿ + è¯ä¹¦ç”Ÿæˆ',
      'Pro ä¼šå‘˜åŠŸèƒ½',
      'é‚®ä»¶æœåŠ¡é›†æˆ',
      'LinkedIn è¯ä¹¦é›†æˆ'
    ]
  },
  
  // Phase 4: ç¤¾åŒºä¸ç®¡ç† (Week 11-12)
  phase4: {
    duration: '2 weeks',
    tasks: [
      'ç¤¾åŒºä¸­å¿ƒåŸºç¡€åŠŸèƒ½',
      'ç®¡ç†åå°',
      'æ•°æ®å¤‡ä»½ç³»ç»Ÿ',
      'æ€§èƒ½ä¼˜åŒ–',
      'å®‰å…¨åŠ å›º'
    ]
  }
}
```

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### å…³é”®æ€§èƒ½æŒ‡æ ‡ (KPI)

| æŒ‡æ ‡ç±»åˆ« | æŒ‡æ ‡åç§° | ç›®æ ‡å€¼ | ç›‘æµ‹é¢‘ç‡ |
|----------|----------|--------|----------|
| **ç”¨æˆ·å¢é•¿** | æœˆæ´»è·ƒç”¨æˆ· | 1,000+ | æ¯æœˆ |
| **ç”¨æˆ·å¢é•¿** | æ–°ç”¨æˆ·æ³¨å†Œ | 200+/æœˆ | æ¯å‘¨ |
| **ç”¨æˆ·ç•™å­˜** | 7å¤©ç•™å­˜ç‡ | 60%+ | æ¯å‘¨ |
| **ç”¨æˆ·ç•™å­˜** | 30å¤©ç•™å­˜ç‡ | 30%+ | æ¯æœˆ |
| **å•†ä¸šåŒ–** | Pro è½¬åŒ–ç‡ | 5%+ | æ¯å‘¨ |
| **å•†ä¸šåŒ–** | æœˆæ”¶å…¥ | $5,000+ | æ¯æœˆ |
| **æŠ€æœ¯æŒ‡æ ‡** | é¡µé¢åŠ è½½æ—¶é—´ | <2s | æ¯æ—¥ |
| **æŠ€æœ¯æŒ‡æ ‡** | API å“åº”æ—¶é—´ | <500ms | æ¯æ—¥ |
| **æŠ€æœ¯æŒ‡æ ‡** | ç³»ç»Ÿå¯ç”¨æ€§ | 99.9%+ | æ¯æœˆ |
| **å†…å®¹è´¨é‡** | å…³å¡å®Œæˆç‡ | 70%+ | æ¯å‘¨ |
| **å†…å®¹è´¨é‡** | ç”¨æˆ·æ»¡æ„åº¦ | 4.5+â­ | æ¯æœˆ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ç¼–åˆ¶æ—¶é—´**: 2024-12-23  
**å®¡æ ¸çŠ¶æ€**: âœ… æœ€ç»ˆç¡®å®šç‰ˆæœ¬  
**äº¤ä»˜å¯¹è±¡**: å¼€å‘å›¢é˜Ÿ

---

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœ‰ä»»ä½•æŠ€æœ¯é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥æ¾„æ¸…ï¼Œè¯·è”ç³»ï¼š
- æŠ€æœ¯è´Ÿè´£äººï¼š[æŠ€æœ¯è´Ÿè´£äººå§“å]
- é‚®ç®±ï¼š[tech@knzn.net]
- é¡¹ç›®ä»“åº“ï¼š[GitHub ä»“åº“é“¾æ¥]