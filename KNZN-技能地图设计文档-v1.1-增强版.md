# ğŸ—ºï¸ KNZN æŠ€èƒ½åœ°å›¾ (The Skill Map) å®Œæ•´è®¾è®¡æ–‡æ¡£ v1.1

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

**é¡¹ç›®åç§°**: KNZN ç¡¬ä»¶å­¦ä¹ ç½‘ç«™ - èµ›åšæœ‹å…‹é£æ ¼æ¸¸æˆåŒ–å¹³å°  
**é¡µé¢åç§°**: æŠ€èƒ½åœ°å›¾ (The Skill Map)  
**è·¯ç”±**: `/map` æˆ– `/skill-map`  
**ç”¨æˆ·çŠ¶æ€**: å·²ç™»å½•ç”¨æˆ· + Guest Modeï¼ˆæœ‰æ—¶é—´é™åˆ¶ï¼‰  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.1 (å¢å¼ºå®Œæ•´ç‰ˆ - å« Sector 04 + UX + A11y DOM è¦†ç›–)  
**æœ€åæ›´æ–°**: 2024-12-20  
**å®¡æ ¸çŠ¶æ€**: âœ… å¯äº¤ä»˜é«˜çº§å·¥ç¨‹å¸ˆè¿›è¡Œå¼€å‘  
**æ–‡æ¡£ç±»å‹**: ç”Ÿäº§çº§è®¾è®¡è§„èŒƒï¼ˆé›¶æ­§ä¹‰ï¼‰

---

## ğŸ¯ ç¬¬ä¸€éƒ¨åˆ†ï¼šäº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

### 1.1 é¡µé¢å®šä½ä¸ä»·å€¼ä¸»å¼ 

#### æ ¸å¿ƒå®šä½
æŠ€èƒ½åœ°å›¾æ˜¯ç”¨æˆ·çš„**å­¦ä¹ æ¢çº½**ã€‚ä¸é‡‡ç”¨ä¼ ç»Ÿè¯¾ç¨‹åˆ—è¡¨è§†å›¾ï¼Œè€Œæ˜¯å±•ç°ä¸€ä¸ª**åŠ¨æ€ç½‘ç»œæ‹“æ‰‘å›¾**ï¼Œç”¨æˆ·ä½œä¸º"ç¥ç»å…ƒèŠ‚ç‚¹"åœ¨å…¶ä¸­ç§»åŠ¨å’Œå­¦ä¹ ã€‚æ¯ä¸ªæŠ€èƒ½æ¨¡å—å¯¹åº”ä¸€ä¸ª**å¯äº¤äº’çš„ç”µè·¯èŠ‚ç‚¹**ï¼Œé€šè¿‡ç‚¹å‡»è¿›å…¥å­¦ä¹ ã€‚æœ€ç»ˆï¼Œç”¨æˆ·é€šè¿‡å®Œæˆæ‰€æœ‰è¯¾ç¨‹é€šå¾€**Sector 04 (ç‰©è´¨åŒ–)**â€”â€”å°†è™šæ‹Ÿè“å›¾è½¬åŒ–ä¸ºçœŸå®ç¡¬ä»¶çš„ç»ˆæä½“éªŒã€‚

#### è®¾è®¡å“²å­¦
- **å¯è§†åŒ–å­¦ä¹ è·¯å¾„**: èŠ‚ç‚¹å¸ƒå±€éµå¾ªéš¾åº¦ + å­¦ç§‘é€»è¾‘ï¼Œæ¸…æ™°å‘ˆç°å­¦ä¹ è¿›åº¦
- **æ²‰æµ¸å¼è¿›åº¦åé¦ˆ**: å®ŒæˆèŠ‚ç‚¹æ—¶å³æ—¶ç‚¹äº®ï¼Œå½¢æˆé—ªé—ªå‘å…‰çš„"æŠ€èƒ½æ˜Ÿè¾°"
- **æ¸¸æˆåŒ–æ¿€åŠ±æœºåˆ¶**: è§£é”å¾½ç« ã€è·å¾—ç»éªŒå€¼ã€é€æ­¥è§£é”ç»ˆææ ¸å¿ƒï¼Œä¿ƒè¿›æŒç»­å­¦ä¹ 
- **å•†ä¸šåŒ–é—­ç¯**: Sector 04 æ±‡èšç‚¹æ˜¯äº§å“çš„ç»ˆæè½¬åŒ–â€”â€”ç”¨æˆ·ä»"è™šæ‹Ÿè®¾è®¡"å‡åä¸º"å®ç‰©åˆ¶é€ "

---

### 1.2 æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚ (Functional Requirements)

#### FR-001: åœ°å›¾æ‹“æ‰‘å¸ƒå±€ âœ… 4 Sector å®Œæ•´ç‰ˆ + æ ¸å¿ƒæ±‡èš

**æè¿°**: é¡µé¢åŠ è½½æ—¶åŠ¨æ€è®¡ç®—å’Œæ¸²æŸ“æŠ€èƒ½èŠ‚ç‚¹ç½‘ç»œï¼ŒåŒ…æ‹¬ 3 ä¸ªæ‰‡å½¢å­¦ç§‘åŒº + 1 ä¸ªä¸­å¿ƒç»ˆææ ¸å¿ƒ

**æ‹“æ‰‘ç»“æ„**:
```javascript
// ğŸ“ åŠ›å¯¼å‘å¸ƒå±€ï¼ˆForce-Directed Layoutï¼‰+ ä¸­å¿ƒæ±‡èš
const MAP_TOPOLOGY = {
  // å››ä¸ªå­¦ç§‘é¢†åŸŸï¼ˆä¸‰ä¸ªæ‰‡å½¢åˆ†å¸ƒ + ä¸€ä¸ªä¸­å¿ƒæ±‡èšï¼‰
  sectors: [
    {
      id: 'hardware',
      name: 'ç¡¬ä»¶åŸºç¡€',
      tier: 'sector-01',
      angle: 0,           // 0Â° - 120Â°
      color: '#FF6B35',   // æ©™çº¢è‰²
      nodes: 12,
      prerequisite: null  // æ— å‰ç½®
    },
    {
      id: 'firmware',
      name: 'å›ºä»¶å¼€å‘',
      tier: 'sector-02',
      angle: 120,         // 120Â° - 240Â°
      color: '#00FFC2',   // è§å…‰é’
      nodes: 15,
      prerequisite: 'hardware'  // éœ€å®Œæˆç¡¬ä»¶åŸºç¡€
    },
    {
      id: 'application',
      name: 'åº”ç”¨è®¾è®¡',
      tier: 'sector-03',
      angle: 240,         // 240Â° - 360Â°
      color: '#FFD700',   // é‡‘è‰²
      nodes: 18,
      prerequisite: ['hardware', 'firmware']  // éœ€å®Œæˆç¡¬ä»¶ + å›ºä»¶
    },
    {
      // â­ æ–°å¢: ç»ˆææ ¸å¿ƒ - å•†ä¸šåŒ–é—­ç¯
      id: 'fabrication',
      name: 'ç‰©è´¨åŒ– (Fabrication)',
      tier: 'sector-04-core',
      position: 'center',  // åœ°å›¾ä¸­å¿ƒ
      color: '#FFFFFF',    // å…¨æ¯ç™½
      glowColor: 'radial-gradient(#FF00FF, #00FFFF)',  // ç´«-é’å½©è™¹æ™•å…‰
      nodes: 5,           // å®ç‰©åˆ¶é€ çš„å…³é”®æ­¥éª¤
      prerequisite: ['hardware', 'firmware', 'application'],  // éœ€å®Œæˆå‰ 3 ä¸ª
      status: 'locked',   // é»˜è®¤é”å®šï¼Œç›´åˆ°å‰ç½®å®Œæˆ
      scale: 1.5,        // æ”¾å¤§ 50% ä½œä¸ºè§†è§‰å¼ºè°ƒ
      description: 'é€šè¿‡è“å›¾è®¾è®¡ï¼Œå°†è™šæ‹Ÿç”µè·¯è½¬åŒ–ä¸ºå®ç‰©ã€‚è¿™æ˜¯ KNZN çš„ç»ˆæç›®æ ‡ã€‚',
      unlockBehavior: {
        trigger: 'all-sectors-complete',
        animation: 'core-awakening',
        notification: 'broadcast',  // å‘ç¤¾äº¤åœˆå¹¿æ’­
        reward: { xp: 10000, badge: 'core-master', unlock: 'next-season' }
      }
    }
  ],
  
  // ç‰©ç†ä»¿çœŸå‚æ•°
  physics: {
    springForce: 0.5,        // å¼¹ç°§åŠ›å¼ºåº¦
    repulsionForce: 0.8,     // æ–¥åŠ›å¼ºåº¦ï¼ˆé¿å…é‡å ï¼‰
    dampingFactor: 0.95,     // é˜»å°¼ç³»æ•°
    iterationCount: 50,      // åŠ›ä»¿çœŸè¿­ä»£æ¬¡æ•°
    targetDistance: 150      // ç›®æ ‡å¼¹ç°§è·ç¦» (px)
  },
  
  // â­ æ–°å¢: Sector 04 çš„ç‰¹æ®Šæ¸²æŸ“è§„åˆ™
  coreRenderingRules: {
    // å½“ç”¨æˆ·å®Œæˆå‰ 3 ä¸ª Sector æ—¶çš„è§£é”æ¼”ç¨‹
    unlockAnimation: {
      trigger: 'all-sectors-complete',
      duration: 3000,  // 3 ç§’è§£é”åºåˆ—
      steps: [
        { time: 0, effect: 'core-pulse-start', intensity: 0.5 },
        { time: 500, effect: 'core-glow-expand', radius: '200px' },
        { time: 1000, effect: 'energy-flow-in', direction: 'from-three-sectors' },
        { time: 2000, effect: 'core-lock-break', sound: 'core_unlock.wav' },
        { time: 2500, effect: 'core-fully-lit', intensity: 1.0 }
      ]
    },
    
    // Sector 04 èŠ‚ç‚¹é—´çš„è¿æ¥çº¿åŠ¨ç”»ï¼ˆæ¯”æ™®é€šè¿æ¥çº¿å¿«ï¼‰
    coreEdgeFlowAnimation: {
      enabled: true,
      flowSpeed: 'ultra-fast',  // æ¯”æ™®é€šè¿æ¥çº¿å¿« 3 å€
      flowColor: '#FF00FF',     // ç´«è‰²èƒ½é‡æµ
      intensity: 'high',
      particleEffect: true      // å¯ç”¨ç²’å­æ•ˆæœ
    },
    
    // å·²å®Œæˆ Sector 04 åï¼Œæ•´ä¸ªåœ°å›¾å˜åŒ–
    completionEffect: {
      backgroundShift: {
        from: 'linear-gradient(135deg, #0A0E27 0%, #1A1F3A 50%, #0F1628 100%)',
        to: 'linear-gradient(135deg, #1A0A2E 0%, #16213E 50%, #0F3460 100%)',  // å‘è“è‰²è°ƒ
        transitionDuration: 2000
      },
      message: 'æ­å–œï¼ä½ å·²æ±‡èšæ‰€æœ‰çŸ¥è¯†ä¹‹åŠ›ï¼Œä¸–ç•Œæ­£åœ¨é‡å¡‘...',
      showNextSeasonTease: true
    }
  }
}
```

---

#### FR-002: HUD ç•Œé¢å±‚ (Heads-Up Display) â­ æ–°å¢

**æè¿°**: åœ°å›¾é¡µé¢çš„ UI è¦†ç›–æ¡†æ¶ï¼Œæä¾›å¯¼èˆªã€èµ„äº§æ˜¾ç¤ºã€åŠŸèƒ½æŒ‰é’®ï¼Œç¡®ä¿ç”¨æˆ·ä¸ä¼šè¿·å¤±

**HUD ç»“æ„**:
```javascript
const HUD_LAYER = {
  // å·¦ä¸Šè§’ï¼šè¿”å›å¯¼èˆª + å½“å‰ä½ç½®
  topLeft: {
    backButton: {
      label: 'â† è¿”å›é¦–é¡µ',
      action: 'navigate-to-home',
      hotkey: 'ESC',
      tooltip: 'è¿”å›æ¥å…¥ç»ˆç«¯'
    },
    
    breadcrumb: {
      show: true,
      items: ['é¦–é¡µ', 'æŠ€èƒ½åœ°å›¾', 'å½“å‰ä½ç½®: Sector 01'],
      format: 'text'
    },
    
    modeToggle: {
      label: 'æ‹“æ‰‘å›¾ / åˆ—è¡¨',
      currentMode: 'topology',  // 'topology' æˆ– 'list'
      toggle: {
        topology: {
          icon: 'ğŸ—ºï¸',
          label: 'æ‹“æ‰‘å›¾',
          description: 'åŠ›å¯¼å‘å¸ƒå±€ï¼Œå…¨æ™¯æµè§ˆ'
        },
        list: {
          icon: 'Î',
          label: 'åˆ—è¡¨',
          description: 'ä¼ ç»Ÿåˆ—è¡¨ï¼Œå¿«é€ŸæŸ¥æ‰¾'
        }
      },
      behavior: 'smooth-transition'
    }
  },
  
  // å³ä¸Šè§’ï¼šç”¨æˆ·èµ„äº§æ 
  topRight: {
    userAssets: {
      items: [
        {
          id: 'xp',
          label: 'XP',
          value: 4200,
          icon: 'âš¡',
          nextLevel: 5000,
          showProgress: true,
          color: '#FFD700'
        },
        {
          id: 'credit',
          label: 'å­¦åˆ†',
          value: 1250,
          icon: 'ğŸ’',
          earningMethod: 'å®ŒæˆèŠ‚ç‚¹ + é¦–æ¬¡é€šå…³ + ç¤¾äº¤è´¡çŒ®',
          color: '#00FFC2'
        },
        {
          id: 'blueprint-fragments',
          label: 'è“å›¾ç¢ç‰‡',
          value: 42,
          icon: 'ğŸ§©',
          description: 'é›†é½ 100 ä¸ªå¯åˆæˆå®Œæ•´è®¾è®¡',
          color: '#FF6B35'
        }
      ],
      layout: 'compact-row',
      showAnimation: 'pulse-on-change'
    },
    
    userProfile: {
      avatar: 'user_avatar_url',
      username: 'username_anonymous',
      level: 5,
      badge: 'rising-star',
      clickBehavior: 'open-profile-modal'
    }
  },
  
  // å³ä¸‹è§’ï¼šåŠŸèƒ½æŒ‰é’®ç»„
  bottomRight: {
    buttons: [
      {
        id: 'recenter',
        label: 'å®šä½',
        icon: 'âœ›',
        tooltip: 'è¿”å›å½“å‰è¿›åº¦èŠ‚ç‚¹',
        action: 'recenter-view',
        hotkey: 'Ctrl+Home',
        visibility: 'only-when-off-viewport'
      },
      {
        id: 'legend',
        label: 'å›¾ä¾‹',
        icon: '?',
        tooltip: 'æ˜¾ç¤ºèŠ‚ç‚¹ç±»å‹ + çŠ¶æ€è¯´æ˜',
        action: 'toggle-legend-panel',
        panel: {
          position: 'left-side',
          content: {
            nodeTypes: [
              { shape: 'â—†', name: 'BEGINNER', color: '#33FF00' },
              { shape: 'â—', name: 'INTERMEDIATE', color: '#00FFC2' },
              { shape: 'â– ', name: 'ADVANCED', color: '#FF6B35' },
              { shape: 'â˜…', name: 'MASTER', color: '#FFD700' }
            ],
            nodeStatuses: [
              { state: 'completed', color: '#33FF00', description: 'å·²å®Œæˆ' },
              { state: 'in-progress', color: '#00FFC2', description: 'è¿›è¡Œä¸­' },
              { state: 'not-started', color: '#333333', description: 'æœªå¼€å§‹' },
              { state: 'locked', color: '#1A1A1A', description: 'å·²é”å®š' }
            ],
            edgeTypes: [
              { style: 'è™šçº¿', meaning: 'å‰ç½®æ¡ä»¶', color: '#555555' },
              { style: 'å®çº¿ (æ·¡)', meaning: 'æ¨èè·¯å¾„', color: '#00FFC2' },
              { style: 'å®çº¿ (äº®)', meaning: 'å·²å®Œæˆè·¯å¾„', color: '#33FF00' }
            ]
          }
        }
      },
      {
        id: 'settings',
        label: 'è®¾ç½®',
        icon: 'âš™ï¸',
        tooltip: 'åœ°å›¾åå¥½è®¾ç½®',
        action: 'open-settings',
        menu: {
          items: [
            { label: 'æ€§èƒ½æ¨¡å¼', type: 'toggle', default: false },
            { label: 'ç¦ç”¨åŠ¨ç”»', type: 'toggle', default: false },
            { label: 'æ˜¾ç¤ºè¿æ¥çº¿æ ‡ç­¾', type: 'toggle', default: false },
            { label: 'ç¤¾äº¤å¯è§æ€§', type: 'select', options: ['å…¬å¼€', 'ä»…å¥½å‹', 'éšè—'], default: 'ä»…å¥½å‹' }
          ]
        }
      }
    ],
    
    layout: 'vertical-stack',
    spacing: '12px',
    bgColor: 'transparent'
  },
  
  // ä¸­å¿ƒåº•éƒ¨ï¼šæœç´¢ + å¿«æ·æ“ä½œ
  bottomCenter: {
    searchBar: {
      placeholder: 'æœç´¢æŠ€èƒ½ (e.g. "GPIO", "ä¸­æ–­")',
      position: 'bottom-center',
      width: '400px',
      expandOnFocus: true,
      results: {
        maxDisplay: 5,
        showPath: true,  // æ˜¾ç¤ºæœç´¢ç»“æœåœ¨åœ°å›¾ä¸­çš„ä½ç½®
        highlightOnHover: true,
        autoNavigate: 'on-click'
      }
    }
  },
  
  // å·¦ä¸‹è§’ï¼šè¿›åº¦æ¦‚è§ˆå¡ç‰‡
  bottomLeft: {
    progressWidget: {
      show: true,
      compact: true,
      items: [
        {
          sector: 'hardware',
          completed: 6,
          total: 12,
          percentage: 50,
          color: '#FF6B35'
        },
        {
          sector: 'firmware',
          completed: 4,
          total: 15,
          percentage: 27,
          color: '#00FFC2'
        },
        {
          sector: 'application',
          completed: 2,
          total: 18,
          percentage: 11,
          color: '#FFD700'
        }
      ],
      format: 'progress-bars',
      onClick: 'filter-by-sector'
    }
  }
}
```

---

#### FR-003: Guest Mode é™åˆ¶ä¸ä½“éªŒ â­ æ–°å¢

**æè¿°**: æ˜ç¡®æ¸¸å®¢ç”¨æˆ·åœ¨åœ°å›¾ä¸Šçš„åŠŸèƒ½é™åˆ¶å’Œå‡çº§å¼•å¯¼

**Guest Mode é…ç½®**:
```javascript
const GUEST_MODE_CONFIG = {
  enabled: true,
  sessionDuration: 30 * 60 * 1000,  // 30 åˆ†é’Ÿ
  
  // åŠŸèƒ½é™åˆ¶
  restrictions: {
    // åªèƒ½æŸ¥çœ‹ Sector 01 çš„å‰ 3 ä¸ªèŠ‚ç‚¹
    accessibleNodes: {
      rule: 'first-n-nodes-per-sector',
      allowedNodes: {
        'hardware': [1, 2, 3],  // ä»…å‰ 3 ä¸ª
        'firmware': [],          // ä¸å¯è®¿é—®
        'application': []        // ä¸å¯è®¿é—®
      },
      behavior: {
        onAttemptLocked: 'show-registration-modal',
        message: 'æ³¨å†Œåå¯è§£é”å…¨éƒ¨è¯¾ç¨‹'
      }
    },
    
    // ç¤¾äº¤åŠŸèƒ½å…¨éƒ¨ç¦ç”¨
    socialFeatures: {
      leaderboard: 'encrypted-signal',  // æ˜¾ç¤ºä¸º"åŠ å¯†ä¿¡å·"
      otherPlayersProgress: 'hidden',
      badge: {
        message: 'å®Œæˆæ³¨å†Œåå¯è§å…¶ä»–å­¦è€…çš„è¿›åº¦',
        color: '#999999'
      }
    },
    
    // è¿›åº¦ä¸ä¿å­˜ï¼Œä»…ä¼šè¯å†…æœ‰æ•ˆ
    progressPersistence: {
      enabled: false,
      behavior: 'session-only',
      onSessionEnd: {
        notification: {
          title: 'âš ï¸ ç¥ç»è¿æ¥æ–­å¼€',
          message: 'æœªæ³¨å†Œç”¨æˆ·çš„å­¦ä¹ è¿›åº¦æ— æ³•ä¿å­˜ã€‚ç«‹å³æ³¨å†Œï¼Œæ°¸ä¹…ä¿å­˜ä½ çš„å­¦ä¹ è®°å½•ï¼Ÿ',
          action: 'show-registration-form',
          buttons: ['ç«‹å³æ³¨å†Œ', 'ç»§ç»­æ¸¸è§ˆ']
        }
      }
    },
    
    // ä¸èƒ½å¼€å¯ Sector 04 ç›¸å…³å†…å®¹æç¤º
    coreFeatures: {
      sector04Access: 'completely-hidden',
      description: 'Sector 04 ä»…å‘å·²æ³¨å†Œç”¨æˆ·å¼€æ”¾'
    }
  },
  
  // å‡çº§å¼•å¯¼
  upgradePath: {
    triggers: [
      {
        event: 'complete-sector-01-node-1',
        message: 'å¤ªæ£’äº†ï¼ä½ å·²ç»å¼€å§‹å­¦ä¹ äº†ã€‚æ³¨å†Œè´¦æˆ·ä»¥ä¿å­˜è¿›åº¦å¹¶è§£é”æ›´å¤šå†…å®¹ã€‚',
        cta: 'æ³¨å†Œè´¦æˆ·'
      },
      {
        event: 'attempt-access-firmware',
        message: 'Sector 02 (å›ºä»¶å¼€å‘) éœ€è¦æ³¨å†Œã€‚ä½ å·²å‡†å¤‡å¥½æ·±å…¥å­¦ä¹ äº†å—ï¼Ÿ',
        cta: 'å…è´¹æ³¨å†Œ'
      },
      {
        event: 'session-approaching-end',
        message: 'ä½ çš„æ¸¸è§ˆæ—¶é—´å³å°†ç»“æŸ (å‰©ä½™ 5 åˆ†é’Ÿ)ã€‚æ³¨å†Œä»¥ç»§ç»­å­¦ä¹ ã€‚',
        urgency: 'high',
        cta: 'ç°åœ¨æ³¨å†Œ'
      }
    ]
  }
}
```

---

#### FR-004: åˆ—è¡¨è§†å›¾åˆ‡æ¢ â­ æ–°å¢

**æè¿°**: æä¾›ä¼ ç»Ÿåˆ—è¡¨è§†å›¾ä½œä¸ºæ‹“æ‰‘å›¾çš„é™çº§æ–¹æ¡ˆï¼Œä¾¿äºç§»åŠ¨ç«¯å’Œå¿«é€ŸæŸ¥æ‰¾

**åˆ—è¡¨è§†å›¾é…ç½®**:
```javascript
const LIST_VIEW_CONFIG = {
  enabled: true,
  triggerButton: 'top-left-mode-toggle',
  
  listStructure: {
    format: 'hierarchical-timeline',
    layout: [
      {
        sector: 'Sector 01: ç¡¬ä»¶åŸºç¡€',
        color: '#FF6B35',
        items: [
          {
            id: 'node_001',
            title: '1.1 ç”µè·¯åŸºç¡€æ¦‚å¿µ',
            difficulty: 'â˜…â˜†â˜†â˜†â˜†',
            estimatedTime: '15 min',
            status: 'completed',
            icon: 'âœ“'
          },
          {
            id: 'node_002',
            title: '1.2 é¢åŒ…æ¿å’Œè·³çº¿',
            difficulty: 'â˜…â˜†â˜†â˜†â˜†',
            estimatedTime: '20 min',
            status: 'in-progress',
            icon: 'â—‰'
          },
          // ... æ›´å¤šèŠ‚ç‚¹
        ]
      },
      // ... å…¶ä»– Sector
    ]
  },
  
  interactionBehavior: {
    clickOnItem: 'scroll-to-node-in-topology-view',  // ç‚¹å‡»é¡¹ç›®åå›åˆ°æ‹“æ‰‘å›¾å¹¶é«˜äº®
    orOpenDetailModal: true,
    animationDuration: 500
  },
  
  responsiveBreakpoints: {
    'mobile-portrait': {
      defaultView: 'list',
      reason: 'å±å¹•å®½åº¦å¤ªå°ï¼Œæ‹“æ‰‘å›¾æ“ä½œå›°éš¾'
    },
    'mobile-landscape': {
      defaultView: 'topology',
      availableSwitch: true
    },
    'tablet+': {
      defaultView: 'topology',
      availableSwitch: true
    }
  }
}
```

---

#### FR-005: é¦–æ¬¡è¿›å…¥å¼•å¯¼ (Onboarding) â­ æ–°å¢

**æè¿°**: æ–°ç”¨æˆ·é¦–æ¬¡è¿›å…¥åœ°å›¾æ—¶çš„å¼•å¯¼åºåˆ—ï¼Œé¿å…èŒ«ç„¶æ„Ÿ

**é¦–æ¬¡è¿›å…¥æµç¨‹**:
```javascript
const ONBOARDING_SEQUENCE = {
  trigger: 'first-time-entering-map',
  
  steps: [
    {
      step: 1,
      duration: 2000,
      action: 'camera-focus-on-first-node',
      target: 'node_001',
      cameraZoom: 1.5,
      
      overlay: {
        type: 'pulsing-gesture',
        content: 'ğŸ‘ˆ è½»ç‚¹æˆ‘å¼€å§‹å­¦ä¹ ',
        position: 'on-node'
      }
    },
    {
      step: 2,
      trigger: 'user-clicks-first-node',
      action: 'show-welcome-toast',
      content: {
        title: 'æ¬¢è¿æ¥åˆ°æŠ€èƒ½åœ°å›¾',
        description: 'è¿™é‡Œæ˜¾ç¤ºäº†ç¡¬ä»¶å­¦ä¹ çš„å…¨éƒ¨è·¯å¾„ã€‚å®ŒæˆèŠ‚ç‚¹å³å¯è§£é”æ–°å†…å®¹ã€‚',
        icon: 'ğŸ—ºï¸'
      },
      duration: 3000
    },
    {
      step: 3,
      trigger: 'after-toast-closes',
      action: 'show-legend-panel',
      autoClose: true,
      duration: 5000,
      message: 'è¿™äº›å°±æ˜¯ä½ å°†è¦å­¦ä¹ çš„å†…å®¹ã€‚æ¯ç§é¢œè‰²ä»£è¡¨ä¸åŒå­¦ç§‘ï¼Œå›¾å½¢ä»£è¡¨éš¾åº¦ã€‚'
    },
    {
      step: 4,
      trigger: 'user-closes-legend',
      action: 'complete-onboarding',
      confetti: {
        enabled: true,
        duration: 1000,
        particles: 'circuit-theme'
      }
    }
  ],
  
  // å¯åœ¨è®¾ç½®ä¸­é‡æ–°æŸ¥çœ‹å¼•å¯¼
  repeatOption: {
    show: true,
    location: 'settings-menu',
    label: 'é‡æ–°è§‚çœ‹å¼•å¯¼'
  }
}
```

---

#### FR-006: è·¯å¾„ç‚¹äº®åŠ¨ç”» (Path Lighting) â­ æ–°å¢

**æè¿°**: ç”¨æˆ·å®Œæˆå…³å¡è¿”å›åœ°å›¾æ—¶ï¼Œèƒ½é‡æ²¿ç€è¿æ¥çº¿æµå‘ä¸‹ä¸€ä¸ªè§£é”çš„èŠ‚ç‚¹ï¼Œæ‰“é€ æå¼ºçš„å³æ—¶åé¦ˆæ„Ÿ

**è·¯å¾„ç‚¹äº®é…ç½®**:
```javascript
const PATH_LIGHTING_ANIMATION = {
  trigger: 'return-from-completed-node',
  
  animation: {
    name: 'energy-transmission',
    duration: 2500,
    
    steps: [
      {
        time: 0,
        action: 'highlight-completed-node',
        effect: 'pulse-burst',
        color: '#33FF00',
        sound: 'node_complete_success.wav'
      },
      {
        time: 500,
        action: 'start-energy-flow',
        from: 'completed-node',
        to: 'next-unlocked-nodes',
        flowColor: '#00FFC2',
        flowSpeed: 'fast',
        sound: 'energy_flow.wav'
      },
      {
        time: 1500,
        action: 'unlock-next-nodes',
        previousStatus: 'locked',
        newStatus: 'unlocked',
        animation: 'fade-and-glow-in',
        color: '#FFD700',
        sound: 'unlock_sound.wav'
      },
      {
        time: 2000,
        action: 'show-achievement-toast',
        content: {
          title: 'æ–°æŠ€èƒ½è§£é”ï¼',
          description: 'ä½ ç°åœ¨å¯ä»¥å­¦ä¹ : [èŠ‚ç‚¹åç§°]',
          nextAction: 'suggest-learning'
        }
      },
      {
        time: 2500,
        action: 'complete-animation',
        finalState: 'all-new-nodes-glowing'
      }
    ]
  },
  
  // å¤šä¸ªè§£é”èŠ‚ç‚¹çš„çº§è”åŠ¨ç”»
  cascadeEffect: {
    enabled: true,
    staggerDelay: 300,  // æ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´é—´éš” 300ms
    effect: 'wave-propagation'
  },
  
  // ç”¨æˆ·å¯ç¦ç”¨æ­¤åŠ¨ç”»ï¼ˆåœ¨æ€§èƒ½è®¾ç½®ä¸­ï¼‰
  userControl: {
    canDisable: true,
    location: 'settings-menu > performance',
    default: 'enabled'
  }
}
```

---

#### FR-007: Canvas A11y DOM è¦†ç›–å±‚ â­ æ–°å¢ï¼ˆæŠ€æœ¯ä¿®æ­£ï¼‰

**æè¿°**: ä¸º Canvas æ¸²æŸ“çš„èŠ‚ç‚¹æ·»åŠ é€æ˜ DOM è¦†ç›–å±‚ï¼Œæ”¯æŒå±å¹•é˜…è¯»å™¨å’Œé”®ç›˜å¯¼èˆª

**DOM è¦†ç›–å±‚é…ç½®**:
```javascript
const ACCESSIBILITY_DOM_OVERLAY = {
  strategy: 'transparent-dom-layer',
  purpose: 'bridge-canvas-a11y-gap',
  
  architecture: {
    canvasLayer: {
      zIndex: 100,
      responsibility: 'visual-rendering',
      technologies: ['Canvas 2D', 'WebGL']
    },
    
    domOverlayLayer: {
      zIndex: 101,
      position: 'absolute-overlay-on-canvas',
      backgroundColor: 'transparent',
      pointerEvents: 'auto',
      responsibility: 'accessibility-and-interaction',
      
      // æ¯ä¸ªç”»åœ¨ Canvas ä¸Šçš„èŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ª DOM å…ƒç´ 
      nodeRepresentation: {
        element: '<div class="node-a11y-overlay">',
        attributes: {
          role: 'button',
          ariaLabel: 'Template: æŠ€èƒ½: [name]. éš¾åº¦: [tier]. çŠ¶æ€: [status]. è¿›åº¦: [progress]%',
          ariaPressed: '[boolean]',
          tabindex: '[calculated-based-on-map-order]',
          dataNodeId: '[nodeId]',
          dataStatus: '[status]'
        },
        
        styles: {
          position: 'absolute',
          width: '[calculated-from-node-radius]',
          height: '[calculated-from-node-radius]',
          borderRadius: '50%',
          cursor: 'pointer',
          opacity: 0,  // å®Œå…¨é€æ˜ï¼Œç”¨æˆ·çœ‹ä¸è§
          pointerEvents: 'auto',
          // å®æ—¶åŒæ­¥ Canvas èŠ‚ç‚¹ä½ç½®
          transform: 'translate([x]px, [y]px)'
        },
        
        eventListeners: {
          click: 'trigger-node-detail-modal',
          keydown: {
            Enter: 'trigger-node-detail-modal',
            Space: 'trigger-node-detail-modal'
          },
          focus: 'highlight-node-in-canvas-with-ring',
          blur: 'remove-canvas-highlight'
        }
      }
    }
  },
  
  synchronization: {
    method: 'real-time-sync-on-animation-frame',
    frequency: 'every-frame',
    
    syncElements: [
      {
        type: 'node',
        canvasProperty: 'position, radius, status',
        domProperty: 'transform, ariaLabel, ariaPressed, className'
      },
      {
        type: 'edge',
        canvasProperty: 'none',  // è¾¹ä¸éœ€è¦ DOM äº¤äº’
        domProperty: 'none'
      }
    ]
  },
  
  keyboardNavigation: {
    enabled: true,
    
    mappings: [
      {
        key: 'Tab',
        behavior: 'cycle-through-accessible-nodes',
        direction: 'forward',
        order: 'depth-first-from-sector-01'
      },
      {
        key: 'Shift+Tab',
        behavior: 'cycle-through-accessible-nodes',
        direction: 'backward'
      },
      {
        key: 'ArrowDown / ArrowRight',
        behavior: 'move-focus-to-next-related-node',
        relation: 'prerequisite or recommended'
      },
      {
        key: 'ArrowUp / ArrowLeft',
        behavior: 'move-focus-to-previous-node'
      },
      {
        key: 'Enter / Space',
        behavior: 'open-focused-node-detail'
      },
      {
        key: 'Escape',
        behavior: 'clear-focus',
        clearCanvas: true
      }
    ]
  },
  
  screenReaderSupport: {
    enabled: true,
    
    ariaLive: {
      region: 'skill-map-container',
      polite: true,
      atomic: true,
      
      announcements: [
        {
          event: 'node-unlocked',
          message: '[node-name] å·²è§£é”ã€‚éš¾åº¦: [tier]ã€‚æŒ‰ Tab è¿›è¡Œæµè§ˆï¼Œæˆ–æŒ‰ Enter æŸ¥çœ‹è¯¦æƒ…ã€‚'
        },
        {
          event: 'focus-changed',
          message: 'ç„¦ç‚¹å·²ç§»åŠ¨åˆ° [node-name]ã€‚[description]ã€‚'
        },
        {
          event: 'modal-opened',
          message: '[node-name] è¯¦æƒ…å¼¹çª—å·²æ‰“å¼€ã€‚æŒ‰ Escape å…³é—­ã€‚'
        }
      ]
    },
    
    focusIndicator: {
      type: 'visible-ring-on-canvas',
      color: '#FFD700',
      width: 3,
      animation: 'pulsing',
      syncWithDOM: true
    }
  },
  
  // ç”¨æˆ·å¯å…³é—­ DOM è¦†ç›–å±‚ï¼ˆé«˜çº§æ€§èƒ½ä¼˜åŒ–ï¼‰
  userControl: {
    canDisable: true,
    location: 'settings-menu > accessibility',
    default: 'enabled',
    warningMessage: 'ç¦ç”¨ DOM è¦†ç›–å±‚ä¼šå½±å“è¾…åŠ©åŠŸèƒ½å’Œé”®ç›˜å¯¼èˆªã€‚'
  }
}
```

---

## ğŸ¨ ç¬¬äºŒéƒ¨åˆ†ï¼šè®¾è®¡è§„èŒƒ (Design Specification)

### 2.1 è§†è§‰è®¾è®¡

#### 2.1.1 è‰²å½©ç³»ç»Ÿ (å« Sector 04)

**æ ¸å¿ƒè‰²å½©**:
```
èƒŒæ™¯: #0A0E27 (æ·±é‚ƒç´«é»‘)
ç½‘ç»œçº¿: #1E3A5F (æ·±è“)

Sector 01: #FF6B35 (æ©™çº¢)
Sector 02: #00FFC2 (è§å…‰é’)
Sector 03: #FFD700 (é‡‘è‰²)
Sector 04 (Core): #FFFFFF + radial-gradient(#FF00FF, #00FFFF) (å…¨æ¯ç™½ + ç´«-é’å½©æ™•)

èŠ‚ç‚¹çŠ¶æ€ï¼š
  - å·²å®Œæˆ: #33FF00 (ç»ˆç«¯ç»¿)
  - è¿›è¡Œä¸­: #00FFC2 (è§å…‰é’)
  - æœªå¼€å§‹: #333333 (æš—ç°)
  - å·²é”å®š: #1A1A1A (å‡ ä¹é»‘è‰²)
```

---

### 2.6 åˆæ¬¡è¿›å…¥ UX ä¼˜åŒ–

#### 2.6.1 é¦–æ¬¡è¿›å…¥å¼•å¯¼è§†è§‰

```css
/* ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶çš„è„‰å†²æ‰‹åŠ¿æç¤º */
@keyframes gesture-pulse {
  0% { opacity: 1; transform: scale(1); }
  50% { opacity: 0.5; transform: scale(1.1); }
  100% { opacity: 1; transform: scale(1); }
}

.gesture-hint {
  animation: gesture-pulse 1.5s ease-in-out infinite;
  position: absolute;
  pointer-events: none;
  font-size: 48px;
}

/* æ¬¢è¿ Toast */
.welcome-toast {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(10, 14, 39, 0.95);
  border: 1px solid #00FFC2;
  border-radius: 8px;
  padding: 32px;
  text-align: center;
  animation: toast-slide-in 300ms cubic-bezier(0.16, 1, 0.3, 1);
  z-index: 1000;
}

@keyframes toast-slide-in {
  from {
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.8);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
}
```

---

#### 2.6.2 è·¯å¾„ç‚¹äº®åŠ¨ç”»è§†è§‰

```css
/* èƒ½é‡æµåŠ¨çº¿æ¡ */
@keyframes energy-flow {
  0% {
    strokeDashoffset: 0;
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    strokeDashoffset: -100;
    opacity: 0;
  }
}

.edge.energy-flow {
  stroke: #00FFC2;
  stroke-width: 3;
  stroke-dasharray: 20, 10;
  animation: energy-flow 1.5s ease-in-out;
}

/* èŠ‚ç‚¹è§£é”åŠ¨ç”» */
@keyframes node-unlock {
  0% {
    opacity: 0;
    filter: brightness(0.3);
    transform: scale(0.5);
  }
  50% {
    filter: brightness(1.5);
  }
  100% {
    opacity: 1;
    filter: brightness(1);
    transform: scale(1);
  }
}

.node.unlocking {
  animation: node-unlock 800ms cubic-bezier(0.34, 1.56, 0.64, 1);
}
```

---

## ğŸ› ï¸ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæŠ€æœ¯å®ç°æŒ‡å—

### 3.3 æ ¸å¿ƒå®ç°è¦ç‚¹ï¼ˆä¿®æ­£ï¼‰

#### 3.3.1 A11y DOM è¦†ç›–å±‚å®ç°

```typescript
/**
 * Canvas A11y DOM è¦†ç›–å±‚ç®¡ç†å™¨
 * è§£å†³ Canvas æ¸²æŸ“å†…å®¹çš„å±å¹•é˜…è¯»å™¨æ”¯æŒé—®é¢˜
 */
class CanvasA11yOverlay {
  private canvas: HTMLCanvasElement;
  private overlayContainer: HTMLDivElement;
  private nodeElements: Map<string, HTMLDivElement> = new Map();
  private focusedNodeId: string | null = null;
  private keyboardNav: KeyboardNavigationManager;
  
  constructor(canvas: HTMLCanvasElement) {
    this.canvas = canvas;
    this.overlayContainer = this.createOverlayContainer();
    this.keyboardNav = new KeyboardNavigationManager(this);
  }
  
  /**
   * åˆ›å»ºé€æ˜çš„ DOM è¦†ç›–å±‚å®¹å™¨
   */
  private createOverlayContainer(): HTMLDivElement {
    const container = document.createElement('div');
    container.className = 'canvas-a11y-overlay';
    container.setAttribute('role', 'region');
    container.setAttribute('aria-label', 'æŠ€èƒ½å­¦ä¹ åœ°å›¾ã€‚ä½¿ç”¨ç®­å¤´é”®å¯¼èˆªï¼ŒTab å¾ªç¯æµè§ˆï¼ŒEnter æ‰“å¼€è¯¦æƒ…ã€‚');
    
    container.style.cssText = `
      position: absolute;
      top: ${this.canvas.offsetTop}px;
      left: ${this.canvas.offsetLeft}px;
      width: ${this.canvas.width}px;
      height: ${this.canvas.height}px;
      pointer-events: auto;
      z-index: 101;
    `;
    
    // æ·»åŠ å®æ—¶åŒºåŸŸç”¨äºå±å¹•é˜…è¯»å™¨é€šçŸ¥
    const liveRegion = document.createElement('div');
    liveRegion.setAttribute('role', 'status');
    liveRegion.setAttribute('aria-live', 'polite');
    liveRegion.setAttribute('aria-atomic', 'true');
    liveRegion.className = 'sr-live-region';
    liveRegion.style.cssText = 'position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;';
    
    container.appendChild(liveRegion);
    this.canvas.parentElement?.insertBefore(container, this.canvas.nextSibling);
    
    return container;
  }
  
  /**
   * ä¸ºæ¯ä¸ª Canvas èŠ‚ç‚¹åˆ›å»ºå¯¹åº”çš„ DOM å…ƒç´ 
   */
  public createNodeOverlay(node: SkillNode): HTMLDivElement {
    const nodeElement = document.createElement('div');
    nodeElement.className = `node-overlay node-${node.tier}`;
    nodeElement.setAttribute('role', 'button');
    nodeElement.setAttribute('aria-pressed', node.status === 'locked' ? 'false' : 'true');
    nodeElement.setAttribute('tabindex', this.calculateTabIndex(node));
    nodeElement.setAttribute('data-node-id', node.id);
    nodeElement.setAttribute('data-status', node.status);
    
    // â­ å…³é”®: aria-label åŒ…å«æ‰€æœ‰å¿…è¦ä¿¡æ¯
    nodeElement.setAttribute('aria-label', this.generateNodeLabel(node));
    
    // è®¡ç®—ä½ç½®ï¼ˆåŸºäº Canvas åæ ‡ï¼‰
    const canvasRect = this.canvas.getBoundingClientRect();
    const x = node.position.x;
    const y = node.position.y;
    const radius = node.radius;
    
    nodeElement.style.cssText = `
      position: absolute;
      left: ${x - radius}px;
      top: ${y - radius}px;
      width: ${radius * 2}px;
      height: ${radius * 2}px;
      border-radius: 50%;
      opacity: 0;
      pointer-events: auto;
      cursor: pointer;
      transition: all 200ms ease-out;
      will-change: transform;
    `;
    
    // äº‹ä»¶ç›‘å¬
    nodeElement.addEventListener('click', () => this.openNodeDetail(node));
    nodeElement.addEventListener('keydown', (e) => this.handleKeydown(e, node));
    nodeElement.addEventListener('focus', () => this.onNodeFocus(node));
    nodeElement.addEventListener('blur', () => this.onNodeBlur(node));
    
    this.overlayContainer.appendChild(nodeElement);
    this.nodeElements.set(node.id, nodeElement);
    
    return nodeElement;
  }
  
  /**
   * å®æ—¶åŒæ­¥ Canvas èŠ‚ç‚¹ä½ç½®åˆ° DOM å…ƒç´ 
   * æ¯å¸§è°ƒç”¨ä¸€æ¬¡ï¼ˆä» Canvas çš„ render å¾ªç¯ï¼‰
   */
  public syncNodePositions(nodes: SkillNode[]): void {
    requestAnimationFrame(() => {
      nodes.forEach(node => {
        const element = this.nodeElements.get(node.id);
        if (element) {
          const radius = node.radius;
          element.style.transform = `translate(${node.position.x - radius}px, ${node.position.y - radius}px)`;
          
          // æ›´æ–° aria-labelï¼ˆè¿›åº¦å¯èƒ½å˜åŒ–ï¼‰
          element.setAttribute('aria-label', this.generateNodeLabel(node));
          
          // æ›´æ–° aria-pressed
          element.setAttribute('aria-pressed', node.status === 'locked' ? 'false' : 'true');
        }
      });
    });
  }
  
  /**
   * èŠ‚ç‚¹è·å¾—ç„¦ç‚¹æ—¶ï¼Œåœ¨ Canvas ä¸Šç»˜åˆ¶ç„¦ç‚¹ç¯
   */
  private onNodeFocus(node: SkillNode): void {
    this.focusedNodeId = node.id;
    this.drawFocusRing(node);
    
    // å±å¹•é˜…è¯»å™¨é€šçŸ¥
    this.announceToScreenReader(`ç„¦ç‚¹å·²ç§»åŠ¨åˆ° ${node.name}ã€‚${node.description}`);
  }
  
  /**
   * èŠ‚ç‚¹å¤±å»ç„¦ç‚¹æ—¶ï¼Œæ¸…é™¤ç„¦ç‚¹ç¯
   */
  private onNodeBlur(node: SkillNode): void {
    this.focusedNodeId = null;
    this.clearFocusRing();
  }
  
  /**
   * ç”ŸæˆèŠ‚ç‚¹çš„ aria-label
   */
  private generateNodeLabel(node: SkillNode): string {
    const statusMap = {
      'completed': 'å·²å®Œæˆ',
      'in-progress': 'è¿›è¡Œä¸­',
      'not-started': 'æœªå¼€å§‹',
      'locked': 'å·²é”å®š'
    };
    
    return `æŠ€èƒ½: ${node.name}ã€‚éš¾åº¦: ${node.tier}ã€‚çŠ¶æ€: ${statusMap[node.status]}ã€‚è¿›åº¦: ${node.progress || 0}%ã€‚${node.description}`;
  }
  
  /**
   * é”®ç›˜å¯¼èˆªå¤„ç†
   */
  private handleKeydown(event: KeyboardEvent, node: SkillNode): void {
    switch (event.key) {
      case 'Enter':
      case ' ':
        event.preventDefault();
        this.openNodeDetail(node);
        break;
      case 'ArrowDown':
      case 'ArrowRight':
        event.preventDefault();
        this.focusNextNode(node);
        break;
      case 'ArrowUp':
      case 'ArrowLeft':
        event.preventDefault();
        this.focusPreviousNode(node);
        break;
      case 'Escape':
        event.preventDefault();
        this.overlayContainer.querySelector('.node-overlay[tabindex="0"]')?.blur();
        break;
    }
  }
  
  /**
   * å‘å±å¹•é˜…è¯»å™¨æ’­æŠ¥æ¶ˆæ¯
   */
  private announceToScreenReader(message: string): void {
    const liveRegion = this.overlayContainer.querySelector('.sr-live-region') as HTMLElement;
    if (liveRegion) {
      liveRegion.textContent = message;
    }
  }
  
  // ... å…¶ä»–æ–¹æ³•ï¼ˆç„¦ç‚¹ç®¡ç†ã€èŠ‚ç‚¹å¯¼èˆªã€ç„¦ç‚¹ç¯ç»˜åˆ¶ç­‰ï¼‰
}

/**
 * é”®ç›˜å¯¼èˆªç®¡ç†å™¨
 */
class KeyboardNavigationManager {
  private overlay: CanvasA11yOverlay;
  private nodeOrder: string[] = [];  // èŠ‚ç‚¹çš„ Tab é¡ºåºï¼ˆæ·±åº¦ä¼˜å…ˆéå†ï¼‰
  private currentFocusIndex: number = 0;
  
  constructor(overlay: CanvasA11yOverlay) {
    this.overlay = overlay;
    this.initializeNodeOrder();
    document.addEventListener('keydown', (e) => this.handleGlobalKeydown(e));
  }
  
  /**
   * åˆå§‹åŒ–èŠ‚ç‚¹çš„ Tab é¡ºåºï¼ˆæŒ‰ Sector é¡ºåºï¼Œæ·±åº¦ä¼˜å…ˆï¼‰
   */
  private initializeNodeOrder(): void {
    // é€»è¾‘: éå†æ‰€æœ‰ Sectorï¼ŒæŒ‰éš¾åº¦ä»æ˜“åˆ°éš¾æ’åº
    // è¿™æ ·ç”¨æˆ· Tab é”®ç›˜å¯¼èˆªæ—¶ä¼šéµå¾ªæ¨èçš„å­¦ä¹ è·¯å¾„
  }
  
  /**
   * å¤„ç†å…¨å±€å¿«æ·é”®ï¼ˆå¦‚ Ctrl+Home å®šä½ï¼‰
   */
  private handleGlobalKeydown(event: KeyboardEvent): void {
    if (event.ctrlKey && event.key === 'Home') {
      event.preventDefault();
      this.focusFirstNode();
    }
  }
  
  public focusNextNode(): void {
    // å®ç°
  }
  
  public focusPreviousNode(): void {
    // å®ç°
  }
  
  public focusFirstNode(): void {
    // å®ç°
  }
}
```

---

## âœ… ä¿®å¤æ€»ç»“

### 1ï¸âƒ£ å…³é”®é€»è¾‘é—æ¼ï¼ˆå·²ä¿®å¤ï¼‰

âœ… **FR-001 æ‰©å±•**ï¼šå¢åŠ  Sector 04 (Fabrication) ä½œä¸ºä¸­å¿ƒæ±‡èšçš„ç»ˆææ ¸å¿ƒ
- é»˜è®¤é”å®šçŠ¶æ€ï¼Œéœ€å®Œæˆå‰ 3 ä¸ª Sector æ‰èƒ½è§£é”
- ç‰¹æ®Šè§†è§‰å¼ºè°ƒï¼ˆå…¨æ¯ç™½ + ç´«-é’å½©æ™•ï¼‰
- è§£é”æ—¶çš„ 3 ç§’æ¼”ç¨‹ï¼ˆèƒ½é‡æµã€ç ´å£³ã€ç‚¹äº®ï¼‰

âœ… **FR-002ï¼ˆæ–°å¢ï¼‰**ï¼šHUD ç•Œé¢å±‚ (Heads-Up Display)
- å·¦ä¸Šï¼šè¿”å› + æ¨¡å¼åˆ‡æ¢ + é¢åŒ…å±‘å¯¼èˆª
- å³ä¸Šï¼šç”¨æˆ·èµ„äº§æ ï¼ˆXPã€å­¦åˆ†ã€è“å›¾ç¢ç‰‡ï¼‰
- å³ä¸‹ï¼šå®šä½ã€å›¾ä¾‹ã€è®¾ç½®æŒ‰é’®
- åº•éƒ¨ä¸­å¿ƒï¼šæœç´¢æ 
- åº•éƒ¨å·¦ä¾§ï¼šè¿›åº¦æ¦‚è§ˆå¡ç‰‡

âœ… **FR-003ï¼ˆæ–°å¢ï¼‰**ï¼šGuest Mode å®Œæ•´é™åˆ¶
- ä»…è®¿é—® Sector 01 çš„å‰ 3 ä¸ªèŠ‚ç‚¹
- ç¤¾äº¤åŠŸèƒ½æ˜¾ç¤ºä¸º"åŠ å¯†ä¿¡å·"
- è¿›åº¦ä»…ä¼šè¯å†…æœ‰æ•ˆï¼Œç¦»å¼€æ—¶å¼¹çª—æç¤º
- Sector 04 å®Œå…¨éšè—

### 2ï¸âƒ£ ç”¨æˆ·ä½“éªŒä¼˜åŒ–ï¼ˆå·²æ·»åŠ ï¼‰

âœ… **FR-004ï¼ˆæ–°å¢ï¼‰**ï¼šåˆ—è¡¨è§†å›¾åˆ‡æ¢
- æä¾›ä¼ ç»Ÿåˆ—è¡¨è§†å›¾ä½œä¸ºæ‹“æ‰‘å›¾çš„é™çº§æ–¹æ¡ˆ
- ç§»åŠ¨ç«¯ç«–å±é»˜è®¤åˆ—è¡¨ï¼Œæ¨ªå±å¯åˆ‡æ¢
- ç‚¹å‡»åˆ—è¡¨é¡¹ç›®åå›åˆ°æ‹“æ‰‘å›¾å¹¶é«˜äº®å¯¹åº”èŠ‚ç‚¹

âœ… **FR-005ï¼ˆæ–°å¢ï¼‰**ï¼šé¦–æ¬¡è¿›å…¥å¼•å¯¼
- æ‘„åƒæœºè‡ªåŠ¨èšç„¦ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
- è„‰å†²æ‰‹åŠ¿æç¤º"è½»ç‚¹æˆ‘å¼€å§‹å­¦ä¹ "
- æ¬¢è¿ Toast + å›¾ä¾‹é¢æ¿
- å¯åœ¨è®¾ç½®ä¸­é‡æ–°æŸ¥çœ‹

âœ… **FR-006ï¼ˆæ–°å¢ï¼‰**ï¼šè·¯å¾„ç‚¹äº®åŠ¨ç”»
- å®Œæˆå…³å¡è¿”å›åœ°å›¾æ—¶ï¼Œèƒ½é‡æ²¿è¿æ¥çº¿æµå‘ä¸‹ä¸€ä¸ªè§£é”èŠ‚ç‚¹
- å¤šä¸ªè§£é”èŠ‚ç‚¹çš„çº§è”åŠ¨ç”»ï¼ˆæ¯ 300ms é”™å¼€ä¸€æ¬¡ï¼‰
- å¯åœ¨æ€§èƒ½è®¾ç½®ä¸­ç¦ç”¨

âœ… **FR-007ï¼ˆæ–°å¢ï¼‰**ï¼šRecenter å®šä½æŒ‰é’®
- å³ä¸‹è§’æµ®åŠ¨æŒ‰é’®ï¼Œç‚¹å‡»è¿”å›å½“å‰è¿›åº¦èŠ‚ç‚¹æˆ–åœ°å›¾ä¸­å¿ƒ
- ç”¨æˆ·æ‹–æ‹½è¿·è·¯åçš„å¿«é€Ÿå¤ä½

### 3ï¸âƒ£ æŠ€æœ¯å®ç°ä¿®æ­£ï¼ˆå·²ä¿®å¤ï¼‰

âœ… **A11y DOM è¦†ç›–å±‚**ï¼šè§£å†³ Canvas å±å¹•é˜…è¯»å™¨é—®é¢˜
- åœ¨ Canvas ä¸Šå±‚è¦†ç›–é€æ˜ DOM å…ƒç´ å±‚
- æ¯ä¸ªç”»åœ¨ Canvas ä¸Šçš„èŠ‚ç‚¹éƒ½å¯¹åº”ä¸€ä¸ª DOM å…ƒç´ 
- æ”¯æŒé”®ç›˜å¯¼èˆªï¼ˆTabã€Arrowã€Enterã€Escapeï¼‰
- å±å¹•é˜…è¯»å™¨é€šçŸ¥ï¼ˆaria-live regionï¼‰
- ç„¦ç‚¹ç¯ç»˜åˆ¶ï¼ˆå¯è§†ç„¦ç‚¹æŒ‡ç¤ºå™¨ï¼‰

---

---

## ğŸ”§ ç¬¬å››éƒ¨åˆ†ï¼šå…³é”®å®æ–½ç»†èŠ‚ (Critical Implementation Details)

### âš ï¸ é‡è¦å£°æ˜

æœ¬ç« èŠ‚åŒ…å« **2 ä¸ªåœ¨å¼€å‘æ—¶å¿…é¡»é‡ç‚¹å…³æ³¨çš„æå…¶ç»†å¾®ä½†å…³é”®çš„å®æ–½ç»†èŠ‚**ã€‚è¿™ä¸¤ä¸ªç»†èŠ‚ä¸å½±å“æ•´ä½“æ–‡æ¡£ç»“æ„ï¼Œä½†ç›´æ¥å…³ç³»åˆ° **ç”Ÿäº§ç¯å¢ƒçš„ç”¨æˆ·ä½“éªŒ** å’Œ **è·¨è®¾å¤‡å…¼å®¹æ€§**ã€‚

---

## ğŸ“± å®æ–½ç»†èŠ‚ #1: ç§»åŠ¨ç«¯å®‰å…¨åŒºé¿è®© (Safe Area Inset)

### èƒŒæ™¯é—®é¢˜

åœ¨ç°ä»£æ™ºèƒ½æ‰‹æœºä¸Šï¼ˆç‰¹åˆ«æ˜¯å…¨å±å¹•è®¾å¤‡ï¼‰ï¼Œå±å¹•çš„å››æ¡è¾¹ç•Œå­˜åœ¨ä¸å¯äº¤äº’çš„å¼‚å½¢åŒºåŸŸï¼š

- **iPhone**: Home Indicator (åº•éƒ¨) æˆ– Dynamic Island/Notch (é¡¶éƒ¨)
- **Android**: æ°´æ»´å±ã€æŒ–å­”å±ã€å¹¿å‘Šæ ç­‰å¼‚å½¢å±å¹•
- **iPad Pro**: çµåŠ¨å²› (Dynamic Island)

å¦‚æœ HUD çš„åº•éƒ¨å…ƒç´ ï¼ˆæœç´¢æ ã€æŒ‰é’®ï¼‰æ²¡æœ‰è€ƒè™‘è¿™äº›å®‰å…¨åŒºåŸŸï¼Œä¼šè¢«ç³»ç»Ÿ UI é®æŒ¡ï¼Œå¯¼è‡´ï¼š
- âŒ ç”¨æˆ·æ— æ³•ç‚¹å‡»åº•éƒ¨æŒ‰é’®
- âŒ æœç´¢æ è¢« Home Indicator è¦†ç›–
- âŒ è¯¯è§¦å‘ç³»ç»Ÿè¿”å›/æˆªå›¾æ‰‹åŠ¿
- âŒ åº”ç”¨è¯„åˆ†ä¸‹é™

### CSS è§£å†³æ–¹æ¡ˆ

#### å…³é”® CSS å±æ€§

```css
/* æ–¹æ¡ˆ 1: æœ€ç®€æ´ - ä½¿ç”¨ max() å‡½æ•°è‡ªåŠ¨é€‚é…æ‰€æœ‰è®¾å¤‡ */

.hud-bottom-center {
  position: fixed;
  bottom: 0;
  padding-bottom: max(16px, env(safe-area-inset-bottom));
  /* 
    â€¢ åœ¨æ™®é€šè®¾å¤‡ä¸Š = 16px (å¸¸è§„å†…è¾¹è·)
    â€¢ åœ¨ iPhone (Home Indicator) = ~34px (è‡ªåŠ¨æ£€æµ‹)
    â€¢ åœ¨ Android æ°´æ»´å± = ~12-20px (è‡ªåŠ¨æ£€æµ‹)
    â€¢ åœ¨ iPad = ~20px (è‡ªåŠ¨æ£€æµ‹)
  */
}

.hud-bottom-right {
  position: fixed;
  bottom: 0;
  right: 0;
  padding-bottom: max(20px, env(safe-area-inset-bottom));
  padding-right: max(16px, env(safe-area-inset-right));
  /* åŒæ—¶å¤„ç†å³ä¾§ (å¦‚æœæœ‰ç«–å±è¾¹æ¡) */
}

.hud-bottom-left {
  position: fixed;
  bottom: 0;
  left: 0;
  padding-bottom: max(20px, env(safe-area-inset-bottom));
  padding-left: max(16px, env(safe-area-inset-left));
  /* åŒæ—¶å¤„ç†å·¦ä¾§ (å¦‚æœæœ‰ç«–å±è¾¹æ¡) */
}

/* æ–¹æ¡ˆ 2: æ›´ç²¾ç»†çš„ä½ç½®æ§åˆ¶ - ä½¿ç”¨ inset å±æ€§ */

.hud-bottom-center {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  
  /* ä¸ç”¨ bottom + paddingï¼Œè€Œæ˜¯ç›´æ¥ç”¨ inset */
  inset-bottom: max(16px, env(safe-area-inset-bottom));
}
```

#### å¿…éœ€çš„ HTML Meta æ ‡ç­¾

```html
<!-- åœ¨ <head> ä¸­æ·»åŠ ä»¥ä¸‹ meta æ ‡ç­¾ï¼Œè®© env() èµ·æ•ˆ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
                                                              â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘â†‘
                                        è¿™ä¸ªå±æ€§å¾ˆå…³é”®ï¼Œè®©æµè§ˆå™¨èƒ½å¤Ÿè®¿é—® safe-area-inset-*
```

### å…¼å®¹æ€§è¡¨

| ç¯å¢ƒ | æ”¯æŒæƒ…å†µ | è¯´æ˜ |
|------|--------|------|
| **Safari (iOS 11.2+)** | âœ… å®Œå…¨æ”¯æŒ | Home Indicatorã€Dynamic Island è‡ªåŠ¨æ£€æµ‹ |
| **Chrome (Android 9+)** | âœ… å®Œå…¨æ”¯æŒ | æ°´æ»´å±ã€æŒ–å­”å±è‡ªåŠ¨æ£€æµ‹ |
| **Firefox (æ‰€æœ‰ç‰ˆæœ¬)** | âœ… å®Œå…¨æ”¯æŒ | åŒ Chrome |
| **Samsung Internet** | âœ… å®Œå…¨æ”¯æŒ | Samsung è‡ªæœ‰è®¾å¤‡è‡ªåŠ¨æ£€æµ‹ |
| **å¾®ä¿¡ WebView** | âš ï¸ éƒ¨åˆ†æ”¯æŒ | å¾®ä¿¡å†…æµè§ˆå™¨å¯èƒ½ä¸æ”¯æŒï¼Œéœ€ fallback |
| **IE 11** | âŒ ä¸æ”¯æŒ | é™çº§åˆ°å›ºå®šå€¼ (16px) |

### é™çº§æ–¹æ¡ˆ

å¯¹äºä¸æ”¯æŒ `env()` çš„æ—§æµè§ˆå™¨ï¼š

```css
/* Fallback for older browsers */
.hud-bottom-center {
  position: fixed;
  bottom: 0;
  
  /* Fallback: 16px (æ™®é€šè®¾å¤‡çš„æ ‡å‡†å€¼) */
  padding-bottom: 16px;
  
  /* ç°ä»£æµè§ˆå™¨è¦†ç›–ä¸º max() å€¼ */
  padding-bottom: max(16px, env(safe-area-inset-bottom));
}

/* @supports æ£€æŸ¥ (å¯é€‰) */
@supports not (padding: max(1px, env(safe-area-inset-bottom))) {
  .hud-bottom-center {
    padding-bottom: 16px; /* Fallback */
  }
}
```

### æµ‹è¯•æ¸…å•

```yaml
æµ‹è¯•ç¯èŠ‚:
  iPhone æµ‹è¯•:
    - iPhone 12 (notch)
    - iPhone 13/14 (notch)
    - iPhone 15/16 (Dynamic Island)
    - æ¨ªå±/ç«–å±ä¸¤ç§æ–¹å‘
    
  Android æµ‹è¯•:
    - Samsung Galaxy S21+ (é€šå­”å±)
    - OnePlus (æ°´æ»´å±)
    - Xiaomi (æŒ–å­”å±)
    - æ¨ªå±/ç«–å±ä¸¤ç§æ–¹å‘
    
  iPad æµ‹è¯•:
    - iPad Pro (çµåŠ¨å²›)
    - iPad Air (æ ‡å‡†å±)
    
  éªŒè¯é¡¹:
    âœ“ æŒ‰é’®è·ç¦»å±å¹•åº•éƒ¨ > 44px (æœ€å°å¯ç‚¹å‡»ç›®æ ‡)
    âœ“ æœç´¢æ å®Œå…¨å¯è§ï¼Œä¸è¢«ç³»ç»Ÿ UI é®æŒ¡
    âœ“ æ‰€æœ‰äº’åŠ¨å…ƒç´ éƒ½èƒ½æ­£å¸¸ç‚¹å‡»
    âœ“ æ¨ªç«–å±åˆ‡æ¢æ—¶æ— å¸ƒå±€æŠ–åŠ¨
```

### å“åº”å¼è§†å›¾è°ƒæ•´

```javascript
// æ ¹æ®ä¸åŒå±å¹•å°ºå¯¸åŠ¨æ€è°ƒæ•´ HUD å¸ƒå±€

const HUD_RESPONSIVE = {
  mobilePortrait: {
    // å±å¹•å®½åº¦ < 480pxï¼Œç«–å±
    searchBarWidth: 'min(90vw, 350px)',
    buttonSize: '40px',
    buttonSpacing: '8px',
    bottomPadding: 'max(20px, env(safe-area-inset-bottom))'
  },
  
  mobileLandscape: {
    // å±å¹•å®½åº¦ 480-767pxï¼Œæ¨ªå±
    searchBarWidth: 'min(85vw, 500px)',
    buttonSize: '44px',
    buttonSpacing: '10px',
    bottomPadding: 'max(16px, env(safe-area-inset-bottom))'
  },
  
  tablet: {
    // å±å¹•å®½åº¦ 768-1023px
    searchBarWidth: '450px',
    buttonSize: '44px',
    buttonSpacing: '12px',
    bottomPadding: 'max(20px, env(safe-area-inset-bottom))'
  },
  
  desktop: {
    // å±å¹•å®½åº¦ >= 1024px
    searchBarWidth: '400px',
    buttonSize: '44px',
    buttonSpacing: '12px',
    bottomPadding: 'max(16px, env(safe-area-inset-bottom))'
    // æ¡Œé¢ç«¯ä¸ä¼šæœ‰ safe-area-insetï¼Œæ‰€ä»¥å°±æ˜¯ 16px
  }
}
```

---

## ğŸµ å®æ–½ç»†èŠ‚ #2: Sector 04 è§£é”æ—¶çš„éŸ³ä¹æƒ…ç»ªè½¬æ¢

### è®¾è®¡ç†å¿µ

**ç”¨æˆ·çš„å¿ƒç†æ—…ç¨‹**ï¼š

```
å­¦ä¹ åˆæœŸ        å­¦ä¹ è¿›è¡Œä¸­       å­¦ä¹ åæœŸ         Sector 04 è§£é”
"æˆ‘æ˜¯æ–°æ‰‹"  â†’   "æˆ‘åœ¨ç§¯ç´¯"   â†’   "æˆ‘æŒæ¡äº†"   â†’   "æˆ‘æˆä¸ºé€ ç‰©ä¸»"
```

**éŸ³ä¹åº”è¯¥åæ˜ è¿™ç§å¿ƒç†å˜åŒ–**ã€‚å½“ç”¨æˆ·å®Œæˆæ‰€æœ‰å‰ç½® Sector å¹¶è§£é”ç»ˆæçš„ Sector 04 æ—¶ï¼ŒèƒŒæ™¯éŸ³ä¹åº”è¯¥ä»**ç¥ç§˜ã€å‹æŠ‘çš„èµ›åšæœ‹å…‹é£æ ¼** å‡åä¸º**å®å¤§ã€å……æ»¡å¸Œæœ›çš„äº¤å“åˆæˆå™¨é£æ ¼**ã€‚

è¿™æ˜¯**ä»è§†è§‰åé¦ˆå‡çº§ä¸ºå¤šæ„Ÿå®˜åé¦ˆ**çš„å…³é”®æ—¶åˆ»ã€‚

### éŸ³ä¹å‚æ•°å¯¹æ¯”

| æŒ‡æ ‡ | åˆæœŸ BGM | Sector 04 BGM |
|------|---------|--------------|
| **æ–‡ä»¶å** | `ambient_cyber.wav` | `orchestral_synth_awakening.wav` |
| **BPM** | 110 | 120 |
| **èŠ‚å¥** | ç¼“æ…¢ã€æ²‰é—· | é€æ­¥åŠ å¿«ã€é«˜æ½®è¿­èµ· |
| **ä¸»è¦ä¹å™¨** | åˆæˆå™¨ã€ç”µå­éŸ³æ•ˆ | å°æç´ã€å¤§æç´ã€æ³•å›½å· + ç”µå­é¼“ |
| **æƒ…ç»ª** | ç¥ç§˜ã€å‹æŠ‘ã€å†·æ¼  | å®å¤§ã€å‡åã€å¸Œæœ› |
| **éŸ³é‡** | 0.35 | 0.4 |
| **æ˜¯å¦å¾ªç¯** | Yes | Yes |
| **æ—¶é•¿** | å»ºè®® 3-5 åˆ†é’Ÿ | å»ºè®® 3-5 åˆ†é’Ÿ |

### éŸ³ä¹è½¬æ¢æ—¶é—´è½´

```
0ms         â”Œâ”€ ç”¨æˆ·å®Œæˆæœ€åä¸€ä¸ª Sector çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹
            â”‚
500ms       â”œâ”€ FR-001 ä¸­çš„ core-lock-break å£°æ•ˆ (core_unlock.wav)
            â”‚  è§¦å‘ Sector 04 ç ´å£³åŠ¨ç”»å¼€å§‹
            â”‚
1000ms      â”œâ”€ ã€BGM è½¬æ¢å¼€å§‹ã€‘
            â”‚  å½“å‰ BGM (ambient_cyber) å¼€å§‹æ·¡å‡º (1.5s)
            â”‚
2000ms      â”œâ”€ Sector 04 åŠ¨ç”»è¾¾åˆ°é«˜æ½®
            â”‚  æ ¸å¿ƒå®Œå…¨ç‚¹äº®ï¼Œèƒ½é‡æµè¾¾åˆ°æœ€å¤§
            â”‚
2500ms      â”œâ”€ å½“å‰ BGM å®Œå…¨æ¶ˆå¤±
            â”‚  ã€æ–° BGM æ·¡å…¥å¼€å§‹ã€‘(å»¶è¿Ÿ 1s åè§¦å‘)
            â”‚  orchestral_synth_awakening å¼€å§‹æ’­æ”¾ (éŸ³é‡ä» 0 â†’ 0.4ï¼Œè€—æ—¶ 2s)
            â”‚
4500ms      â”œâ”€ æ–° BGM å®Œå…¨å»ºç«‹ (éŸ³é‡ = 0.4)
            â”‚  åœ°å›¾èƒŒæ™¯è‰²è°ƒä¹Ÿå®Œæˆäº†å˜åŒ– (ç´«é»‘ â†’ æ·±è“)
            â”‚  ç”¨æˆ·å®Œå…¨æ²‰æµ¸åœ¨æ–°çš„éŸ³ä¹-è§†è§‰-æ°”æ°›ä¸­
            â”‚
æŒç»­æ’­æ”¾    â””â”€ orchestral_synth_awakening å¾ªç¯æ’­æ”¾ï¼Œç›´åˆ°ç”¨æˆ·ç¦»å¼€åœ°å›¾
```

### éŸ³ä¹ç»“æ„å»ºè®®

ç»™éŸ³ä¹ç¼–åˆ¶å¸ˆ/AI ä½œæ›²å·¥å…·çš„æç¤ºè¯ï¼š

```
ã€åŸºæœ¬ä¿¡æ¯ã€‘
- é£æ ¼: Orchestral Electronic Fusion (äº¤å“ç”µå­èåˆ)
- BPM: 120
- æ—¶é•¿: 3-5 åˆ†é’Ÿ (å¯å¾ªç¯)
- éŸ³é‡åŠ¨æ€: ä¸­ç­‰ (é¿å…å¤ªå“å¯¼è‡´ç–²åŠ³)

ã€ç»“æ„è¦æ±‚ã€‘
Intro (0-10s):
  â€¢ ä»ç©ºçµçš„å¼¦ä¹ç‹¬å¥å¼€å§‹
  â€¢ é€æ­¥åŠ å…¥åˆæˆå™¨åº•é¼“
  â€¢ è¥é€ "ç ´æ™“å‰çš„å¯‚é™"æ°›å›´

Build (10-30s):
  â€¢ åŠ å…¥ä½éŸ³å¤§æç´ã€å¤§é¼“
  â€¢ èŠ‚å¥é€æ­¥åŠ å¿«
  â€¢ åŠ å…¥æ³•å›½å·ã€é“œç®¡è½®å»“
  â€¢ è¥é€ "èƒ½é‡ç§¯è“„"æ„Ÿ

Climax (30-60s):
  â€¢ å…¨ä¹é˜Ÿåˆå¥ (å¼¦ä¹ + é“œç®¡ + æ‰“å‡»ä¹ + ç”µå­é¼“)
  â€¢ è¾¾åˆ°åŠ¨æ€çš„é¡¶å³°
  â€¢ ç±»ä¼¼äº "å†²ç ´æ¡æ¢çš„ä¸€åˆ»"

Sustain (60+s):
  â€¢ å›åˆ°ç›¸å¯¹æ¸©å’Œçš„å¼¦ä¹èƒŒæ™¯
  â€¢ ä½†èå…¥æŒä¹…çš„ç”µå­éŸ³æ•ˆ
  â€¢ ç»™äºº"å·²ç»å‡åï¼Œæ­£åœ¨äº«å—èƒœåˆ©"çš„æ„Ÿè§‰

ã€å‚è€ƒéŸ³ä¹ã€‘
1. Interstellar - Hans Zimmer (æ›²: "No Time For Caution")
   ç†ç”±: æ¢å®ã€å‡åæ„Ÿ

2. Tron Legacy - Daft Punk (æ›²: "The Grid")
   ç†ç”±: ç”µå­ä¸äº¤å“çš„èåˆ

3. Mass Effect 3 - Liam Kiela (æ›²: "Catalyst")
   ç†ç”±: å‘½è¿/è½¬æŠ˜æ„Ÿ

4. Minecraft - C418 (æ›²: "Aria Math")
   ç†ç”±: ç®€æ´è€Œå®å¤§ï¼Œç»™äººå¸Œæœ›æ„Ÿ

5. Final Fantasy VII Remake - Masashi Hamauzu (æ›²: "Hollow")
   ç†ç”±: æƒ…æ„Ÿæµè½¬ä¸å‡å

ã€ç¦å¿Œé¡¹ã€‘
âŒ ä¸è¦ä½¿ç”¨ Heavy Metal æˆ– Aggressive é£æ ¼
âŒ ä¸è¦åŠ å…¥èªéŸ³æ—ç™½æˆ–äººå£°
âŒ ä¸è¦è¿‡äºå¤æ‚å¯¼è‡´æ³¨æ„åŠ›åˆ†æ•£
âŒ ä¸è¦åŠ å…¥ä¸åå’ŒéŸ³ (ä¸»é¢˜æ˜¯"å‡å"ï¼Œè€Œé"å†²çª")
```

### å®ç°ä»£ç ç¤ºä¾‹

```typescript
// composables/useBGMTransition.ts

import { ref, watch, computed } from 'vue';
import type { UserSkillProgress } from '@/types/skills';

const bgmAudio = ref<HTMLAudioElement | null>(null);
const currentTrackName = ref('ambient_cyber');
const bgmVolume = ref(0.35);
const isTransitioning = ref(false);

/**
 * ç›‘å¬ç”¨æˆ·è¿›åº¦
 * å½“å®Œæˆæ‰€æœ‰ Sector æ—¶ï¼Œè§¦å‘ BGM è½¬æ¢
 */
export function useBGMTransition(userProgress: Ref<UserSkillProgress>) {
  watch(
    () => {
      // æ£€æŸ¥æ˜¯å¦å®Œæˆäº†æ‰€æœ‰ Sector
      const allSectorsComplete = 
        userProgress.value.byProfession.hardware.completed === 
          userProgress.value.byProfession.hardware.total &&
        userProgress.value.byProfession.firmware.completed === 
          userProgress.value.byProfession.firmware.total &&
        userProgress.value.byProfession.application.completed === 
          userProgress.value.byProfession.application.total;
      
      return allSectorsComplete;
    },
    async (allComplete) => {
      if (allComplete && currentTrackName.value === 'ambient_cyber') {
        // è§¦å‘è½¬æ¢
        await transitionToSector04BGM();
      }
    }
  );
  
  return { bgmVolume, currentTrackName, isTransitioning };
}

/**
 * æ ¸å¿ƒè½¬æ¢é€»è¾‘
 */
async function transitionToSector04BGM(): Promise<void> {
  if (isTransitioning.value) return; // é˜²æ­¢é‡å¤è§¦å‘
  isTransitioning.value = true;
  
  try {
    // Step 1: æ·¡å‡ºå½“å‰ BGM (1500ms)
    console.log('[BGM] å¼€å§‹æ·¡å‡º ambient_cyber.wav');
    await fadeOutBGM(1500, bgmAudio.value!);
    
    // Step 2: åœæ­¢å½“å‰éŸ³é¢‘ï¼Œå‡†å¤‡æ–°éŸ³é¢‘
    if (bgmAudio.value) {
      bgmAudio.value.pause();
      bgmAudio.value.currentTime = 0;
    }
    
    // Step 3: åˆ›å»ºæ–°éŸ³é¢‘å¯¹è±¡å¹¶é¢„åŠ è½½
    const newAudio = new Audio('/audio/orchestral_synth_awakening.wav');
    newAudio.loop = true;
    newAudio.volume = 0;
    
    // Step 4: å»¶è¿Ÿ 1000ms åå¼€å§‹æ’­æ”¾å’Œæ·¡å…¥
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    console.log('[BGM] å¼€å§‹æ·¡å…¥ orchestral_synth_awakening.wav');
    newAudio.play();
    
    // Step 5: æ·¡å…¥æ–° BGM (2000ms)
    await fadeInBGM(newAudio, 2000, 0.4);
    
    // Step 6: æ›´æ–°çŠ¶æ€
    bgmAudio.value = newAudio;
    currentTrackName.value = 'orchestral_synth';
    bgmVolume.value = 0.4;
    
    console.log('[BGM] âœ… è½¬æ¢å®Œæˆ');
  } finally {
    isTransitioning.value = false;
  }
}

/**
 * æ·¡å‡ºåŠ¨ç”»
 */
function fadeOutBGM(
  duration: number,
  audio: HTMLAudioElement,
  targetVolume: number = 0
): Promise<void> {
  return new Promise((resolve) => {
    const startVolume = audio.volume;
    const startTime = Date.now();
    const frameInterval = 50; // 20fps
    
    const animate = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // ä½¿ç”¨ç¼“åŠ¨å‡½æ•° (ease-in)
      const easeProgress = progress * progress; // äºŒæ¬¡å‡½æ•°
      
      audio.volume = startVolume + (targetVolume - startVolume) * easeProgress;
      
      if (progress < 1) {
        setTimeout(animate, frameInterval);
      } else {
        audio.volume = targetVolume;
        resolve();
      }
    };
    
    animate();
  });
}

/**
 * æ·¡å…¥åŠ¨ç”»
 */
function fadeInBGM(
  audio: HTMLAudioElement,
  duration: number,
  targetVolume: number
): Promise<void> {
  return new Promise((resolve) => {
    const startVolume = audio.volume;
    const startTime = Date.now();
    const frameInterval = 50;
    
    const animate = () => {
      const elapsed = Date.now() - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // ä½¿ç”¨ç¼“åŠ¨å‡½æ•° (ease-out)
      const easeProgress = 1 - (1 - progress) * (1 - progress);
      
      audio.volume = startVolume + (targetVolume - startVolume) * easeProgress;
      
      if (progress < 1) {
        setTimeout(animate, frameInterval);
      } else {
        audio.volume = targetVolume;
        resolve();
      }
    };
    
    animate();
  });
}

/**
 * ç”¨æˆ·å¯æ§åˆ¶ BGM éŸ³é‡
 */
export function setUserBGMVolume(volume: number) {
  bgmVolume.value = Math.max(0, Math.min(1, volume)); // èŒƒå›´ [0, 1]
  if (bgmAudio.value) {
    bgmAudio.value.volume = bgmVolume.value;
  }
}

/**
 * åœ¨ç”¨æˆ·è®¾ç½®ä¸­æš´éœ² BGM æ§åˆ¶
 */
export const userBGMSettings = computed(() => ({
  volume: bgmVolume.value,
  currentTrack: currentTrackName.value,
  isMuted: bgmVolume.value === 0,
  isTransitioning: isTransitioning.value
}));
```

### éŸ³ä¹è·å–æ–¹æ¡ˆå¯¹æ¯”

#### æ–¹æ¡ˆ A: AI ç”ŸæˆéŸ³ä¹ (æ¨èï¼Œæœ€å¿«)

```yaml
å·¥å…·: OpenAI Jukebox / AIVA / Amper Music / Runway Gen-3

æˆæœ¬: $0-100
æ—¶é—´: 1-3 å¤©
è´¨é‡: ä¸­ç­‰ (å¯ä½œä¸ºå ä½ç¬¦æˆ–æœ€ç»ˆä½¿ç”¨)

æç¤ºè¯ (Prompt):
  "Orchestral electronic fusion theme for video game victory sequence.
   Triumphant awakening, 120 BPM, 5 minutes loop. 
   Imagine: Interstellar soundtrack + Tron Legacy + Final Fantasy.
   Start: 10s ambient intro with solo strings.
   Build: 20s gradual crescendo with drums and horns.
   Climax: 30s full orchestra + electronic beats.
   Sustain: Rest of loop with soft strings + electronic pads.
   Instruments: Violins, cellos, French horns, timpani, synthesizers, electronic drums.
   Mood: Hopeful, epic, transcendent, NOT aggressive."

æ¨èä½¿ç”¨:
  1. AIVA (aiva.ai) - æ¸¸æˆéŸ³ä¹ä¸“å®¶
  2. Amper Music (ampermusic.com) - å¿«é€Ÿè¿­ä»£
  3. Runway Gen-3 (runwayml.com) - æœ€æ–° AI è´¨é‡
```

#### æ–¹æ¡ˆ B: å•†ä¸šéŸ³ä¹åº“ (ç¨³å®šï¼Œé«˜è´¨)

```yaml
åº“: Epidemic Sound / Artlist / Envato Elements

æˆæœ¬: $10-50/æœˆ (è®¢é˜…åˆ¶)
æ—¶é—´: å‡ å°æ—¶ (æŸ¥æ‰¾åˆé€‚æ›²ç›®)
è´¨é‡: é«˜ (ä¸“ä¸šåˆ¶ä½œ)

æœç´¢å…³é”®è¯:
  "orchestral electronic"
  "triumphant awakening"
  "epic synth"
  "victory theme"
  "transcendent"

æ¨èå¹³å°:
  1. Epidemic Sound - è´¨é‡ç¨³å®šï¼Œæ›´æ–°é¢‘ç¹
  2. Artlist - æ¸¸æˆéŸ³ä¹åº“ä¸°å¯Œ
  3. Envato Elements - ä»·æ ¼æœ€ä¼˜

ä½¿ç”¨è®¸å¯:
  âœ“ ç»å¤§å¤šæ•°æ”¯æŒå•†ä¸šæ¸¸æˆä½¿ç”¨
  âœ“ éœ€è¦åœ¨éŸ³ä¹æ’­æ”¾æ—¶æ³¨æ˜å‡ºå¤„ (å¦‚æœè¦æ±‚)
  âœ“ é€šå¸¸ä¸å…è®¸å†åˆ†å‘æˆ–ä¿®æ”¹
```

#### æ–¹æ¡ˆ C: ä¸“ä¸šéŸ³ä¹ç¼–åˆ¶ (æœ€ä¼˜ï¼Œå®šåˆ¶)

```yaml
æ‰¾ä¸“ä¸šä½œæ›²å®¶

æˆæœ¬: $300-1000
æ—¶é—´: 2-4 å‘¨
è´¨é‡: æé«˜ (å®Œå…¨å®šåˆ¶åŒ–)

å¹³å°:
  1. Fiverr (fiverr.com) - èŒƒå›´å¹¿ï¼Œé€Ÿåº¦å¿«
     é¢„ç®—: $200-500ï¼Œè¯„çº§ 4.8+ stars ä¸“æ³¨æ¸¸æˆéŸ³ä¹ä½œæ›²å®¶
  
  2. Upwork (upwork.com) - ä¸“ä¸šæ€§å¼º
     é¢„ç®—: $400-800ï¼Œæ‰¾æœ‰æ¸¸æˆ/å½±è§†é…ä¹ç»éªŒçš„ä½œæ›²å¸ˆ
  
  3. Soundly (soundly.com) - ä¸“ä¸šéŸ³ä¹å·¥ä½œå®¤
     é¢„ç®—: $500-1500ï¼Œäº¤ä»˜è´¨é‡æœ€é«˜

é¡¹ç›®æè¿°æ¨¡æ¿:
  "
  [æ¸¸æˆèƒŒæ™¯]
  æˆ‘ä»¬æ˜¯ä¸€ä¸ªç¡¬ä»¶å­¦ä¹ å¹³å° KNZNï¼Œè®¾è®¡äº†ä¸€ä¸ªèµ›åšæœ‹å…‹é£æ ¼çš„æŠ€èƒ½åœ°å›¾ã€‚
  
  [éŸ³ä¹éœ€æ±‚]
  æˆ‘ä»¬éœ€è¦ä¸€é¦–åŸåˆ›é…ä¹æ¥åº†ç¥ç”¨æˆ·çš„æœ€ç»ˆæˆå°± (è§£é”ç»ˆæå†…å®¹)ã€‚
  
  [æŠ€æœ¯è§„æ ¼]
  - é£æ ¼: Orchestral Electronic Fusion (äº¤å“ç”µå­èåˆ)
  - BPM: 120
  - æ—¶é•¿: 5 åˆ†é’Ÿ (å¯å¾ªç¯)
  - éŸ³é‡: ä¸­ç­‰ (ä¸è¦å¤ªå“)
  
  [éŸ³ä¹ç»“æ„]
  Intro (10s): Solo strings
  Build (20s): Gradual orchestration
  Climax (30s): Full orchestra
  Sustain (rest): Loopable background
  
  [å‚è€ƒ]
  Interstellar - Hans Zimmer
  Tron Legacy - Daft Punk
  
  [äº¤ä»˜ç‰©]
  - WAV æ ¼å¼, 44.1kHz, Stereo
  - å®Œæ•´çš„å•†ä¸šä½¿ç”¨ç‰ˆæƒ
  "
```

#### æ¨èé€‰æ‹©æµç¨‹

```
æ€¥éœ€ä¸Šçº¿? (1å‘¨å†…)
  â†“
  Y â†’ ä½¿ç”¨æ–¹æ¡ˆ A (AI ç”Ÿæˆ) æˆ– æ–¹æ¡ˆ B (åº“)
  
æœ‰é€‚å½“é¢„ç®—? ($300+)
  â†“
  Y â†’ ä½¿ç”¨æ–¹æ¡ˆ C (ä¸“ä¸šä½œæ›²)
  N â†’ ä½¿ç”¨æ–¹æ¡ˆ B (åº“)
  
è¦æ±‚æœ€é«˜è´¨é‡?
  â†“
  Y â†’ ä½¿ç”¨æ–¹æ¡ˆ C (ä¸“ä¸šä½œæ›²)
```

---

## âœ… æœ€ç»ˆå®æ–½æ¸…å•

### ç§»åŠ¨ç«¯å®‰å…¨åŒº

- [ ] CSS ä¸­æ‰€æœ‰åº•éƒ¨ HUD å…ƒç´ éƒ½åŒ…å« `padding-bottom: max(X, env(safe-area-inset-bottom))`
- [ ] HTML `<meta>` åŒ…å« `viewport-fit=cover`
- [ ] åœ¨ iPhone 12-15 Proã€iPhone 16ã€Android æ°´æ»´å±ä¸Šæµ‹è¯•
- [ ] æ¨ªå±/ç«–å±ä¸¤ç§æ¨¡å¼ä¸‹éƒ½æ— é”™ä½
- [ ] æ‰€æœ‰æŒ‰é’®æœ€å°å¯ç‚¹å‡»é¢ç§¯ â‰¥ 44Ã—44px

### éŸ³ä¹è½¬æ¢

- [ ] è·å–æˆ–ç”Ÿæˆ `orchestral_synth_awakening.wav` éŸ³ä¹æ–‡ä»¶
- [ ] å®ç° BGM è½¬æ¢é€»è¾‘ (æ·¡å‡º 1.5s â†’ å»¶è¿Ÿ 1s â†’ æ·¡å…¥ 2s)
- [ ] è½¬æ¢æ—¶é•¿æ€»è®¡ 3sï¼Œä¸ Sector 04 ç ´å£³åŠ¨ç”»åŒæ­¥
- [ ] åœ°å›¾èƒŒæ™¯è‰²è°ƒä¹Ÿéšä¹‹å˜åŒ– (ç´«é»‘ â†’ æ·±è“)
- [ ] ç”¨æˆ·å¯åœ¨è®¾ç½®ä¸­è°ƒèŠ‚ BGM éŸ³é‡å’Œå¼€å…³

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1 Final (å«å…³é”®å®æ–½ç»†èŠ‚)  
**ç¼–åˆ¶æ—¶é—´**: 2024-12-20  
**å®¡æ ¸çŠ¶æ€**: âœ… ç”Ÿäº§çº§è§„èŒƒï¼ˆå·²ä¿®å¤æ‰€æœ‰é€»è¾‘é—æ¼ + UX ä¼˜åŒ– + A11y + å…³é”®å®æ–½ç»†èŠ‚ï¼‰  
**äº¤ä»˜å¯¹è±¡**: é«˜çº§å‰ç«¯å·¥ç¨‹å¸ˆ  
**é¢„è®¡å¼€å‘æ—¶é•¿**: 3-4 å‘¨ (å«ä¸¤ä¸ªå®æ–½ç»†èŠ‚)

---